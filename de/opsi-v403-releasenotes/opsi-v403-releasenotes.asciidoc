////
; Copyright (c) uib gmbh (www.uib.de)
; This documentation is owned by uib
; and published under the german creative commons by-sa license
; see:
; http://creativecommons.org/licenses/by-sa/3.0/de/
; http://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; english:
; http://creativecommons.org/licenses/by-sa/3.0/
; http://creativecommons.org/licenses/by-sa/3.0/legalcode
; 
; credits: http://www.opsi.org/credits/
////


:Author:    uib gmbh
:Email:     info@uib.de
:Date:      26.02.2013
:Revision:  4.0.3
:doctype:		book

// Include common opsi terms
include::../common/opsi_terms.asciidoc[]

= opsi Version 4.0.3 Release Notes

// Include common opsi copyright
include::../common/opsi_manual_copyright.asciidoc[]

[[opsi-403-releasenotes-overview]]
== Übersicht der Neuerungen

Das opsi Service Releases 4.0.3 weist eine Fülle von Neuerungen und Detailverbesserungen auf. Hier eine Übersicht:

* opsi Erweiterung: Install-on-shutdown (Kofinanzierungsprojekt)

* neues opsi Feature: Silent-Install

* Lokalisierung für Italienisch und Dänisch

* Freigabe von opsi 4.0.3 für folgende Distributionen:

** UCS 3.1
** Ubuntu 12.10

Die entsprechenden Installationsanleitungen finden Sie wie immer im 'opsi-getting-started' Handbuch

* Abkündigung zum 31.03.2013 der Unterstützung für:

** CentOs 5
** RedHat 5
** OpenSuse 11.3 / 11.4

* opsi-client-agent

** Umfangreich überarbeitete Version
** Freigabe der opsi-Erweiterung: Dynamische Depotauswahl
** opsi Erweiterung: Install-on-shutdown
** opsi Feature: Silent-Install
** Verbessertes Customizing
** Anpassungen für Windows 8 Support
** Überarbeitetes Sessionhandling: Bessere Identifikation der Benutzerkonten.
** Verbesserungen im WAN-Support
** Mehrere kleinere Fixes

* opsi Serverkomponenten

** Verbesserungen im DHCP-Backend
** Neues HostControlSafe-Backend
** Neuerstellung des Webservice-SSL-Zertifkats über opsi-setup

* Windows Netboot Produkte

** Windows 8 / Server 2012 Unterstützung
** Verbesserungen an byAudit-Verfahren
** WinPE-Partitionsgröße konfigurierbar
** Neues Property data_partition_create : Soll eine Datenpartition erzeugt werden, wenn noch Platz verfügbar ist (true/false ; default: true).
** UEFI Support
** Unterstützung für Softwareraid 1: neues Property 'useRaid1' behandelt 2 vorhandene Platten identisch.

* opsi-winst: +
Eine Fülle von Erweiterungen, welche weiter unten beschrieben sind.

* Ankündigung Lizenzwechsel GPLv3 zu AGPLv3: +
Im Laufe des opsi 4.0.3 Releases werden wir zur AGPLv3 wechseln. +
Dieser Lizenzwechsel betrifft nur Firmen, welche opsi als Bestandteil einer Closed Source Lösung vertreiben.
Wer eine Lizenz für den Vertrieb von opsi als Bestandteil einer Closed Source Lösung benötigt, möge uns kontaktieren.

Für Details lesen Sie bitte das opsi-v403-releasenotes Hanbuch bzw. die überarbeiteten opsi Handbücher.

[[opsi-403-releasenotes-eol]]
== Abkündigung

In diesem Kapitel werden die Abkündigung aufgelistet. Diese Distributionsversionen werden aus verschiedenen Gründen nicht mehr weiter von opsi unterstützt.

[[opsi-403-releasenotes-eol_python24]]
=== Abkündigung der Python 2.4 Unterstützung

Mit diesem Featurepack-Release wird offiziell die Unterstützung für Python 2.4 eingestellt. Dies betrifft Python 2.4 Distributionen: Redhat 5 und Centos 5. Die betroffenen Repositories werden am 31.03.2013 geschlossen. Die Paketstände zu diesem Termin, werden auf download.uib.de im Archiv veröffentlicht. Für Betroffene opsi-Systeme empfehlen wir den Upgrade auf die Neuen Distributionsversionen, die noch Unterstützt werden.

[[opsi-403-releasenotes-eol_distros]]
=== Abkündigung: Distributionsversionen

Folgende Systeme werden mangels Maintainance vom Hersteller abgekündigt:

** openSuse 11.3
** Ubuntu 10.10
** Ubuntu 11.04
** Ubuntu 11.10

Auch die oben genannten Repositories werden am 31.03.2013 geschlossen. Für betroffene Installationen empfehlen wir dringend ein OS-Upgrade durch zu führen. Allerdings sollten Sie vorher prüfen, ob die Version zu der Sie aktualisieren wollen auch von opsi unterstützt wird.



[[opsi-403-releasenotes-installation]]
== Hinweise zur Installation

Die Produkte welche im Rahmen dieses Releases veröffentlicht werden, sind in etlichen Teilen voneinander abhängig. Sie sollten daher nicht versuchen nur Teile zu installieren.

Sie sollten dabei zuerst den Server updaten und danach die opsi-Produkte.

Zur Installation der testing Serverpakete müssen Sie das opsi Repository ändern von 'opsi40' auf 'opsi40-testing'. +
Zum Beispiel bei Ubuntu 12.04: +
`deb http://download.opensuse.org/repositories/home:/uibmz:/opsi:/opsi40/xUbuntu_12.04 ./` +
ersetzen durch: +
`deb http://download.opensuse.org/repositories/home:/uibmz:/opsi:/opsi40-testing/xUbuntu_12.04 ./`

Danach müssen Sie Ihre Pakete updaten. +
Zum Beispiel bei Ubuntu / Debian:
[source,prompt]
----
aptitude update
aptitude dist-upgrade
----

Zur Installation der testing opsi Produkte 
[source,prompt]
----
cd /home/opsiproducts
mkdir opsi403
cd opsi403
wget -r -l1 -nc -nd -A "*.opsi" http://download.uib.de/opsi4.0/testing/opsi403/products/
opsi-package-manager -i *.opsi
----
Sollte der wget Befehl scheitern, so muss evtl. die Umgebungsvariable http_proxy auf den korrekten Proxystring gesetzt werden (z.B. http_proxy=http://192.168.1.5:8080/)

////
Die Installation erfordert keine besonderen Arbeiten. Sie erfolgt im Rahmen der normalen Updates ihres Servers und der opsi-Produkte.

Sie sollten dabei zuerst den Server updaten und danach die opsi-Produkte. Dies erledigt der opsi-product-updater:

[source,prompt]
----
opsi-product-updater -i -vv
----
////

Sollten Sie eine Multidepot Umgebung haben, so machen Sie zunächst das Upgrade auf Ihrem config-server, bevor Sie die Depots upgraden.

include::../common/opsi_manual_on_shutdown.asciidoc[]
include::../common/opsi_manual_silentinstall.asciidoc[]


[[opsi-manual-clientagent-ci-custom]]
== Schutz Ihrer Änderungen vor Updates: Das custom Verzeichnis

(Seit opsi-client-agent Version 4.0.3.1)

Möchten Sie Änderungen, welche Sie an den oben genannten Dateien durchgeführt haben, davor schützen, dass selbige beim Einspielen einer neuen Version des opsi-client-agenten verloren gehen, so können Sie hierfür das `custom` Verzeichnis (`/opt/pcbin/install/opsi-client-agent/files/opsi/custom`) verwenden. Das komplette `custom` Verzeichnis wird bei der Installation einer neuen Version des opsi-client-agenten gesichert und wieder hergestellt, so dass hier gemachte Änderungen bei einem Update nicht verloren gehen.

* `custom/cfg/config.ini` +
Diese custom Config-Datei wird als letzte eingelesen, somit gelten die in dieser Datei enthaltenen Werte statt den entsprechenden Einstellungen aus der Standard-Datei `cfg/config.ini`. Ausnahme: die Werte für `pckey` und `bootmode` werden nie aus dieser Datei geholt. Schreiben Sie in diese Datei *nur* die Werte, die Sie tatsächlich gegenüber dem Default geändert haben wollen.

* `custom/winstskin/*.*` +
Alle Dateien aus diesem Verzeichnis werden bei der Installation des opsi-client-agent auf dem Client nach `C:\Program Files (x86)\opsi.org\opsi-client-agent\custom\winstskin` kopiert. Falls vorhanden, wird (ab opsi-winst Version 4.11.3.4) dieses winstskin Verzeichnis bevorzugt verwendet. Es muss alle benötigten Dateien und Einträge vollständig enthalten, da die Inhalte des Standard-winstskin-Verzeichnisses bei Verwendung des `custom/winstskin/` ignoriert werden.

* `custom/notifier/*.*` +
Alle Dateien aus diesem Verzeichnis werden bei der Installation des opsi-client-agent auf dem Client nach `C:\Program Files (x86)\opsi.org\opsi-client-agent\notifier` kopiert und überschreiben dabei die entsprechenden aus dem serverseitigen Standard-Verzeichnis `files/opsi/dist/notifier/` stammenden Dateien.

* `custom/opsiclientd.conf` +
wird, falls vorhanden, bei der Installation des opsi-client-agent auf dem Client nach `C:\Program Files (x86)\opsi.org\opsi-client-agent\opsiclientd` kopiert und überschreibt dabei die aus dem serverseitigen `files/opsi/dist/opsiclientd/` Verzeichnis stammende `opsiclientd.conf`. Es werden also nicht einzelne Werte überschrieben, sondern die komplette Datei, die deshalb alle benötigten Einstellungen vollständig enthalten muss.
*Achtung:* +
Die Anpassung der `opsiclientd.conf` über diese Methode wird nicht empfohlen. Verwenden Sie zur Konfiguration Ihrer Clients Hostparameter/Configs wie im Kapitel zum opsi-client-agent beschrieben. Die Verwendung einer `custom/opsiclientd.conf` ist nur bei extrem komplexen Anpassungen der opsiclientd.conf sinnvoll. Wenn Sie diese Methode anwenden, müssen Sie bei jedem Einspielen einer neuen opsi-client-agent Version auf dem Server überprüfen, ob in der Default Datei `files/opsi/dist/opsiclientd/opsiclientd.conf` Änderungen gemacht oder neue Einträge hinzugefügt wurden, welche Sie in Ihrer Version nachpflegen müssen. Also: +
 *Finger weg, es sei denn Sie wissen wirklich was Sie tun !*

[[opsi-403-releasenotes-driverintegration]]
== Anpassungen bei der Treiberintegrationsmethode byAudit

Einige Hersteller verwenden Modellbezeichnungen, die für diese Methode sehr ungünstig sind, da man einige Sonderzeichen wie / nicht in Datei- oder Verzeichnisnamen verwenden darf. Ein Beispiel dafür wäre als Modelbezeichnung: "5000/6000/7000". Ein Verzeichnis mit dieser Bezeichnung ist wegen den Sonderzeichen nicht gestattet. Seit der dritten Service Release opsi 4.0.3 werden deshalb folgende Sonderzeichen: < > ? " : | \ / * intern durch ein _ ersetzt. Mit dieser Änderung kann man oben genanntes schlechtes Beispiel als: "5000_6000_7000" anlegen und das Verzeichnis wird automatisch zu gewiesen, obwohl die Information in der Hardwareinventarisierung nicht der Verzeichnisstruktur enstprechen.

[[opsi-manual-backends-hostcontrolsafe]]
== HostControlSafe-Backend

Eine Besonderheit beim Standardverhalten von opsi4.0 Methoden ist, dass bei einer Abfrage ohne Angaben von Parametern, alle Objekte abgerufen werden. Beispielsweise gibt der Befehl "host_getObjects" ohne Parameter aufgerufen, alle Host-Objekte zurück. Dieses Verhalten ist im HostControl-Backend etwas problematisch. Besonders bei den beiden Befehlen: "hostControl_shutdown" und "hostControl_reboot". In diesen Fällen würde ein Aufruf dieser Methoden ohne Parameter alle Clients herunterfahren bzw. neustarten.

Deshalb gibt es mit Service Release opsi 4.0.3 an dieser Stelle zwei Änderungen:

* Die Methoden: "hostControl_shutdown" und "hostControl_reboot" brechen seit dieser Release mit dem opsi 4.0 Standardverhalten. Diese beiden Methoden geben nun eine Fehlermeldung zurück, wenn kein Parameter übergeben wurde.
* Es wurde ein neues Backend: HostControlSafe Backend eingeführt, welches standardmäßig bei allen Methoden eine Fehlermeldung ausgegeben wird, wenn keine korrekte Angaben zu den Clients übergeben wird. Um mit einer Methode vom HostControlSafe-Backend alle Clients an zu sprechen, kann man das *-Zeichen verwenden:

[source,prompt]
----
opsi-admin -d method hostControlSafe_shutdown *
----

Aus den oben genannten Gründen, empfehlen wir hostControlSafe-Methoden zu verwenden, wenn man etwas unsicher auf der Konsole ist oder neu anfängt sich mit den Servicemethoden zu beschäftigen.


[[opsi-winst]]
== opsi-winst 4.11.3.5

Die folgenden Beschreibungen sind Auszüge aus dem '{opsi-winst}' Handbuch.

"(...)" kennzeichnet die ausgelassenen Teile.

[[opsi-winst-skins]]
=== Skinnable {opsi-winst}

Ab Version 3.6 verfügt '{opsi-winst}' über eine veränderbare Oberfläche. Seine Elemente liegen im Unterverzeichnis winstskin des Verzeichnisses, in dem der ausgeführte '{opsi-winst}' liegt. Die editierbare Definitionsdatei ist skin.ini. 

Seit Version 4.11.3.5 sucht der 'opsi-winst' nach dem zu verwendenden Skin Verzeichnis in folgender Reihenfolge, wobei das erste Verzeichnis, welches eine skin.ini enthält verwendet wird:

. `%WinstDir%\..\custom\winstskin`
. `%WinstDir%\winstskin`

Mit dem Befehl `SetSkinDirectory` kann ein SkinDirectory auch im Script angegeben werden.
Wird bei diesem Befehl ein leerer oder ungültiger Pafd angegeben, so wird der Defaultpfad verwendet.

Beispiel:
[source,winst]
----
SetSkinDirectory "%ScriptPath%\testskin"
sleepseconds 1
SetSkinDirectory ""
----


[[opsi-winst-params-showmode]]
==== Fenster Modus / Skin

* `SetSkinDirectory` <skindir>
setzt das zu verwendende SkinDirectory und lädt den Skin 
Wird bei diesem Befehl ein leerer oder ungültiger Pafd angegeben, so wird der Defaultpfad verwendet.

Beispiel:
[source,winst]
----
SetSkinDirectory "%ScriptPath%\testskin"
sleepseconds 1
SetSkinDirectory ""
----

[[opsi-winst-commands-logging]]
=== Kommandos zur Steuerung des Logging

(...)

* `SetConfidential` <secret string> +
Dient dazu vertrauliche Informationen (z.B. Passwörter) aus den Logdateien
fernzuhalten. Diese werden dort durch '***(confidential)***' ersetzt. +
Wir der Loglevel auf '9' gesetzt, so werden die 'confidential's im Klartext gelogt. +
Seit Version 4.11.3.5

Beispiel:
[source,winst]
----
message "SetConfidential"
SetConfidential "forbidden"
comment "This is a forbidden string"
comment "should be in the log file: This is a ***(confidential)*** string"
----
Log:
[source,winst]
----
message SetConfidential
comment: This is a ***(secret)*** string
comment: should be in the log file: This is a ***(confidential)*** string
----


[[opsi-winst-numbers]]
=== Umgang mit Zahlen

Es gibt im 'opsi-winst' keine speziellen Variablen für Zahlen. Es gibt allerdings einige Funktionen welche beim Umgang mit Zahlen helfen.

* `calculate(`<str>`)` +
Stringfunktion welche den arithmetischen Ausdruck im String <str> berechnet und als gerundeten integer String zurückgibt. +
Intern werden die Berechnungen mit reellen Zahlen durchgeführt. Die Funktion kennt derzeit die Operatoren `+`, `-`, `*`, `/` sowie Klammern `(`,`)`. +
Im Fehlerfall wird ein leerer String zurückgegeben und der Errorcounter um eins erhöht. Enthält der übergebene String Zeichen, die keine Zahlen oder gültige Operatoren sind, so ist dies ein Fehler. +
Fehlt der zweite Operand, so wird hierfür der erste verwendet: 5+ = 10 ; 5* = 25. Daher sollte beim Zusammensetzen des übergebenen strings verwendete Variablen z.B. mit der Funktion `isNumber` auf Gültigkeit geprüft werden. +
Seit 4.11.3.5

Beispiele:
[source,winst]
----
set $ConstTest$ = "0"
set $CompValue$ = calculate("-1+1")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $ConstTest$ = "1"
set $CompValue$ = calculate("0+1")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $ConstTest$ = "-1"
set $CompValue$ = calculate("0-1")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "5"
set $ConstTest$ = "25"
set $CompValue$ = calculate($string1$+"*"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "5"
set $ConstTest$ = "1"
set $CompValue$ = calculate($string1$+"/"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "0"
set $ConstTest$ = ""
comment " expecting devision by zero error and empty string result"
set $CompValue$ = calculate($string1$+"/"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "9"
set $string2$ = "10"
set $ConstTest$ = "1"
comment "result 0.9 is rounded to 1 "
set $CompValue$ = calculate($string1$+"/"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "10"
set $string2$ = "9"
set $ConstTest$ = "1"
comment "result 1.1111 is rounded to 1 "
set $CompValue$ = calculate($string1$+"/"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "5"
set $ConstTest$ = "55"
comment " rule * before +"
set $CompValue$ = calculate($string1$+"+"+$string2$+"*10")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "5"
set $ConstTest$ = "100"
comment "brackets before  rule * before + "
set $CompValue$ = calculate("("+$string1$+"+"+$string2$+")*10")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "ten"
set $ConstTest$ = ""
comment "invalid char error"
set $CompValue$ = calculate($string1$+"*"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = ""
set $ConstTest$ = "25"
comment "5* is interpreted as 5*5"
set $CompValue$ = calculate($string1$+"*")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = ""
set $ConstTest$ = "10"
comment "5+ is interpreted as 5+5"
set $CompValue$ = calculate($string1$+"+")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "nothing"
set $string2$ = "foo"
set $ConstTest$ = ""
comment "invalid char error"
set $CompValue$ = calculate($string1$+"*"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "foo"
set $ConstTest$ = ""
comment "invalid char error"
set $CompValue$ = calculate($string1$+"/"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
----
Für weitere Beispiele beachten Sie das Produkt 'opsi-winst-test'
und dort den Bereich '$Flag_calculate$ = "on"'

[[opsi-winst-patchtextfile]]
=== PatchTextFile-Sektionen

[[opsi-winst-patchtextfile-params]]
==== Aufrufparameter

Der Name der zu patchenden Datei wird als Parameter übergeben.

Als optionalen Modifier gibt es:

* `/AllNTUserProfiles` +
Wird eine 'PatchTextFile' Sektion mit diesem Modifier aufgerufen und der Pfad zur zu patchenden Datei enthält die Konstante `%UserProfileDir%`, so wird diese Patchsektion für alle Profile ausgeführt. +
Eine 'PatchTextFile' Sektion welche in einer `[ProfileActions]` Sektion aufgerufen wird hat im 'Machine' Modus den Modifier `/AllNTUserProfiles` implizit. Im Loginscript Modus wird dann `%UserProfileDir%` als `%CurrentProfileDir%` interpretiert. +
(Seit Version 4.11.3.5)


[[opsi-winst-linkfolder]]
=== LinkFolder-Sektionen

(...)

In einer LinkFolder-Sektion muss zuerst bestimmt werden, in welchem virtuellen Systemfolder die nachfolgenden Anweisungen arbeiten sollen. Dafür existiert die Anweisung +
`set_basefolder` '<virtueller Systemfolder>' 

Virtuelle Systemfolder, die angesprochen werden können, sind:

'desktop, sendto, startmenu, startup, programs, desktopdirectory, common_startmenu, common_programs, common_startup, common_desktopdirectory'

Die Folder sind virtuell, weil erst durch das Betriebssystem(-Version) bestimmt wird, an welchem physikalischen Ort des Dateisystems sie real existieren. 

Im Rahmen einer normalen 'Maschinen' Installation sind nur die `common*` Systemfolder relevant.

Die Systemfolder 'desktop, sendto, startmenu, startup, programs, desktopdirectory' können nur im Kontext eines eingloggten users bzw. in einem 'userLoginScript' im Rahmen der opsi-Erweiterung 'user Profile Management' verwendet werden.

[[opsi-winst-execwith]]
=== ExecWith Sektionen

[[opsi-winst-execwith-params]]
==== Aufrufparameter (Modifier)

(...)

Es sind folgende '{opsi-winst}'-Optionen verfügbar:

*  `/32Bit` +
Das ist der Default. Der angegebene Interpreterpfad wird als 32 Bit Pfad interpretiert. +
Beispiel: `c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe` ruft (auch auf einem 64bit System) die 32 Bit 'powershell.exe' auf.

*  `/64Bit` +
Der angegebene Interpreterpfad wird als 64 Bit Pfad interpretiert. +
Beispiel: `c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe` ruft (auf einem 64bit System) die 64 Bit 'powershell.exe' auf.

*  `/SysNative` +
Der angegebene Interpreterpfad wird gemäß der OS Architektur interpretiert. +
Beispiel: `c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe` ruft auf einem 64bit System die 64 Bit 'powershell.exe' und auf einem 32bit System die 32 Bit 'powershell.exe'auf.

Seit Version 4.11.3.5 wird, wenn im angegebene Interpreterpfad 'powershell.exe' vorkommt, die temporäre Datei als `.ps1` gespeichert. 

[[opsi-winst-winbatch]]
=== WinBatch-Sektionen

[[opsi-winst-winbatch-params]]
==== Aufrufparameter (Modifier)

*  `/32Bit` +
Das ist der Default. Die in der Sektion angegebene Pfade werden als 32 Bit Pfade interpretiert. +
Beispiel: `c:\windows\system32\regedit.exe` ruft (auch auf einem 64bit System) die 32 Bit 'regedit.exe' auf.

*  `/64Bit` +
Die in der Sektion angegebene Pfade werden als 64 Bit Pfade interpretiert. +
Beispiel: `c:\windows\system32\regedit.exe` ruft (auf einem 64bit System) die 64 Bit 'regedit.exe' auf.

*  `/SysNative` +
Die in der Sektion angegebene Pfade werden gemäß der OS Architektur interpretiert. +
Beispiel: `c:\windows\system32\regedit.exe` ruft auf einem 64bit System die 64 Bit 'regedit.exe' und auf einem 32bit System die 32 Bit 'regedit.exe'auf.

Beispiel:
[source,winst]
----
Winbatch_add_reg winst /64Bit
[Winbatch_add_reg]
"c:\windows\system32\regedit.exe" /s "%scriptpath%\my64.reg"
----

* `/RunAsLoggedonUser` //seit 4.11.3.5 +
Nur im Kontext eines 'userLoginScripts' verfügbar. Startet das Programm als der user der sich gerade einlogt.
Dieser Modifier hat folgende Einschränkungen: +
** Unter NT6 wenig getestet und evtl. nur eingeschränkt wirksam.

[[opsi-winst-ldapsearch]]
=== LDAPsearch Sektion

[[opsi-winst-ldapsearch-syntax]]
==== LDAPsearch Sektion Syntax

Eine LDAPsearch Sektion beinhaltet die Spezifikationen:

(...)

*  `user:` +
Zu verwendender user Name. Seit 4.11.3.5

*  `password:` +
Zu verwendendes user Passwort. Seit 4.11.3.5

(...)

[[opsi-winst-ldapsearch-examples]]
==== Beispiele

(...)

Beispiel mit user / password
[source,winst]
----
comment ""
comment "-------------------------------------"
comment "Testing: "
comment "user / password"
Set $LdapHost$ = "vmix7.uib.local"
Set $LdapPort$ = "389"
Set $LdapUser$ = "cn=Administrator,cn=Users,dc=uib,dc=local"
Set $LdapPassword$ = "Linux123"
Set $LdapResultType$ = "objects"
Set $LdapSearchDn$ = "cn=Users,dc=uib,dc=local"
Set $LdapSearchAttributes$ = "name,objectClass"
Set $LdapFilter$ = "(&(objectclass=*))"

markErrorNumber
set $list1$ = getReturnListFromSection("ldapsearch_users /" + $LdapResultType$)
if errorsOccuredSinceMark > 0
	comment "failed while ldapsearch"
	set $TestResult$ = "not o.k."
else
	comment "passed"
endif

[ldapsearch_users]
targethost: $LdapHost$
targetport: $LdapPort$
user: $LdapUser$
password: $LdapPassword$
dn: $LdapSearchDn$
attributes: $LdapSearchAttributes$
filter: $LdapFilter$
----

[[opsi-configed]]
== opsi-configed 4.0.3.1

[[opsi-manual-configuration-tools-opsi-configed-hostproperties]]
=== Host-Parameter in der Client- und der Serverkonfiguration

Zur besseren Übersicht werden die Host-Parameter jetzt gegliedert nach Funktionsgruppen aufgeführt. 
Die Gruppen sind auf der linken Seite in einer baumartigen Struktur dargestellt. Jeweils die zugehörigen 
Parameter und ihre Werte werden, wenn die Gruppe links aktiviert ist, auf der rechten Seite präsentiert.

.'{opsi-configed}': Tab Hostparameter (Server- und Client-Konfiguration)
image::../images/opsi-configed-hostparameters.png["{opsi-configed}: Tab Hostparameter (Server- und Client-Konfiguration)", width=400]


[[opsi-manual-configuration-tools-opsi-configed-logfiles]]
=== Logdateien

Der Level, bis zu dem die Logeinträge sichtbar sind, kann jetzt mit einem Schieberegler variiert werden, so dass Fehler
leichter gefunden werden können. Der Regler ist auch mausrad-bedienbar.

Event-bezogene Logs können selektiert werden.

.'{opsi-configed}': Tab Logdateien
image::../images/opsi-configed-logfiles.png["{opsi-configed}: Tab Logdateien", width=400]

[[opsi-403-releasenotes-misc]]
== Sonstiges

[[opsi-403-releasenotes-misc-externalReferences]]
=== Verweise auf das opsi-manual

Einige Kapitel dieser Release Notes sind Bestandteil des opsi Handbuchs 'opsi-manual' und verweisen auf weitere Kapitel des opsi Handbuchs.

[[opsi-manual-modules]]
==== Freischaltung kostenpflichtiger Module
Weitere Informationen zur Freischaltung kostenpflichtiger Module finden Sie im 'opsi-manual' im gleichnamigen Kapitel.

[[opsi-manual-clientagent-configuration-webservice]]
==== Konfiguration über den Webservice ({opsi-config-object})
Weitere Informationen zur Konfiguration per Webservice finden Sie im 'opsi-manual' im gleichnamigen Kapitel. 

[[opsi-403-releasenotes-misc-changelogs]]
=== Changelogs:


[[opsi-403-releasenotes-misc-changelogs-opsi-winst]]
==== Changelog opsi-winst

opsi-winst (4.11.3.5) stable; urgency=low

  * del / delete will not delete if the given Filename starts with '\' (eg. '\Dummy')
  * danish localization added
  * italien localization added
  * extended LDAPSearch (username/password)
  * fix: do not store isfatalerror in registry if nor running as admin
  * execwith: winst (/32bit|/64bit|/sysnative) no allowed
  * execwith: if 'powershell.exe' is part of the interpreter string the script extension is '.ps1'
  * winbatch: /32bit|/64bit|/sysnative no allowed
  * wilog: replace ' -->' by ' ==>' because the opsi web service get in trouble because it is interpreted as xml comment, fixes #350
  * switch to Lazarus 1.0 / fpc 2.6.0
  * wisynt: doAktionen, fileActionsMain: do ApplyTextConstants for filesections in fileActionsMain.
      fixes wrong resolution of %CurrentProfileDir% in Files /AllNTuserProfiles
  * wisynt: doLinkFolderActions: fix: now comments allowed between set_link and end_link
  * wisynt: doLinkFolderActions: linkfolder section now  usable in userLoginScripts:
      the predefined basfolders:
      'desktop', 'sendto', 'startmenu', 'programs', 'startup', 'desktopdirectory'
      are pointing to the loggedin user directories if called from userLoginScript
  * wimain: ProcessNonZeroScript: fix: do not run update after setup if setup is failed, fixes #432
  * fix: widatamodul: opsidata4.initproduct now boolean function: false = error
  * new: new winst cli parameter '/productlist <productid>[,<productid>]* as sub parameter to /opsiservice
    try to run the setup-scripts of the given products, change installation states, send log files
  * new: string function calculate(<string expr>) ; calculates the mathematical expression and returns the result as string.
    on error the result is a empty string and the errorcounter is increased
  * new command 'setConfidential <confidential string>' ;
       adds the given string to a list of strings which are replaced with '***(confidential)***' while logging
  * logging: added [<productid>] to log line to use the new configed filter possibilities

-- Detlef Oertel <d.oertel@uib.de>  Thu,  05 Dec 2012:15:00:00 +0200


opsi-winst (4.11.3.4) stable; urgency=low

  * new winbatch parameter /RunAsLoggedOnUser
  * PatchTextFile sections may now called with  %userprofiledir% as part of the file name and /AllNTuserProfiles
     so it will run on all profiles.
     If running in Machine mode, the '/AllNTuserProfiles' is implizit in the [ProfileActions].
     If running in LoginScript mode, the '%userprofiledir%' is the %CurrentProfileDir%.
  * will now look for skins (more exactly: skin.ini) in the following sequence:
    1) by parameter
    2) new custom directory of opsi-client-agent ../custom/winstskin
    3) own winstskin: winstskin

-- Detlef Oertel <d.oertel@uib.de>  Thu,  26 Oct 2012:15:00:00 +0200

[[opsi-403-releasenotes-misc-changelogs-opsi-winst-test]]
==== Changelog opsi-winst-test

opsi-winst-test (4.11.3.5-1) stable; urgency=low

	* Test of Linkfolder in login.opsiscript
	* Test of use of temporary loop constant in subsub call
	* Test of calculate
	* Test of 'no update script if setup is failed': new property: setfailed
	* Test of SetConfidential
	* Test of SetSkinDirectory
	* Test of LDAPSearch (username/password)
	* Test of execwith: winst (/32bit|/64bit|/sysnative)
	* Test of winbatch: /32bit|/64bit|/sysnative
	* Test of PatchTextFile /AllNTuserProfiles
	
-- detlef oertel <d.oertel@uib.de>  Wed,  16 Jan 2013 17:00:13 +0200

opsi-winst-test (4.11.3.4-1) stable; urgency=low

	* Test of Winbatch /RunAsLoggeedOnUser in login.ins
	
-- detlef oertel <d.oertel@uib.de>  Thu,  26 Oct 2012 17:00:13 +0200

[[opsi-403-releasenotes-misc-changelogs-jedit]]
==== Changelog jedit

jedit_5.0.0-3 stable; urgency=low

   * opsi-winst.xml for version 4.11.3.5
   * code cleanup

-- detlef oertel <d.oertel@uib.de>  Fri, 15 Feb 2013 16:01:53 +0200

jedit_5.0.0-2 stable; urgency=low

   * jedit version with localization support

-- rupert röder <r.roeder@uib.de>  Tue, 27 Nov 2012 16:01:53 +0200

[[opsi-403-releasenotes-misc-changelogs-opsi-adminutils]]
==== Changelog opsi-adminutils

opsi-adminutils (4.0.3.-1) stable; urgency=low

  * change to 4.0.3

-- detlef oertel <d.oertel@uib.de>  15 Feb 2013


opsi-adminutils (4.0.2.1-5) stable; urgency=low

  * correct parameters for configed.jnlp URL

-- rupert roeder <r.roeder@uib.de>  10 Jan 2013

opsi-adminutils (4.0.2.1-4) stable; urgency=low

  * removed parameter from configed.jnlp URL
  * removed opsi-configed version from control file

-- detlef oertel <d.oertel@uib.de>  04 Jan 2013


opsi-adminutils (4.0.2.1-3) stable; urgency=low

  * regshot 1.8.3 (include 64-bit)
  * added kitty

-- detlef oertel <d.oertel@uib.de>  11 Oct 2012


opsi-adminutils (4.0.2.1-2) stable; urgency=low
  * swingx.jar
  * configed.jar 4.0.2.5.4
-- bardo wolf <b.wolf@uib.de>  04 Sep 2012


opsi-adminutils (4.0.2.1-1) stable; urgency=low

[[opsi-403-releasenotes-misc-changelogs-opsi-template]]
==== Changelog opsi-template

opsi-template (4.0.3-1) stable; urgency=low

	* default is now without property and 32 Bit

-- detlef oertel <d.oertel@uib.de>  Thu, 27 Sep 2012 16:01:53 +0200

[[opsi-403-releasenotes-misc-changelogs-windows-netboot]]
==== Changelog windows netboot products

windows (4.0.3-1) stable; urgency=low

  * do not copy winpe uefi boot files if not in uefi mode
  * code cleanup
  * new property winpe_partition_size
  * showdrivers.py:
      - Option -V for version output added.
      - byAudit: Translating model and vendor from hwinvent: characters <>?":|\/* will be translated to _

-- uib GmbH <info@uib.de>  Thu, 14 Feb 2013 15:19:15 +0000

windows (4.0.2-2) experimental; urgency=low

  * new property data_partition_create
  * detect if we are on uefi
  * if we are on uefi use gpt partitions
  * win8 (NT 6.2) support
  * new property use_raid1

-- uib GmbH <info@uib.de>  Mon, 27 Aug 2012 15:19:15 +0000


[[opsi-403-releasenotes-misc-changelogs-opsi-client-agent]]
==== Changelog opsi-client-agent

opsi-client-agent (4.0.2.3-1) testing; urgency=low

  * opsiclientd.conf:
    - added new silent_install event
    - added new time event for silent_install
  * fix search algorithm for finding usersessions
  * fixed setting userrights for local opsi-winst
  * added new service-method for cleaning cache (WAN-Support)

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Wed, 14 Nov 2012 09:00:00 +0100

opsi-client-agent (4.0.2.3-2) testing; urgency=low

  * opsiclientd.conf:
    - [event_on_shutdown{installation_pending}]active=False
  * opsiclientd:
    - v4.0.1.75
    - new state installation_pending for future use (event_on_shutdown)
  * new product property: on_shutdown_active (true/false)
  * new updatescript, which installs shutdown files if on_shutdown_active=true

 -- Miriam Michaelis <m.michaelis@uib.de>  Wed, 05 Dec 2012 13:00:00 +0100

opsi-client-agent (4.0.2.3-1) testing; urgency=low

  * opsiclientd:
    - fix for user_cancelable = 0
    - fix for getSessioninformation
    - updated sessionhelper in utilities
    - added /usercontext parameter for user-login events. This option gives now opsi-winst the username.
    - fix for User-Login-Events on Windows 8: Do not fire event, if the Window Management Service is logged on.
  * new custom directory
    - is saved in preinst and restored in postinst
    - cfg/config.ini values will be overwritten by values from custom/config.ini (execption: pckey , bootmode) fixes #333
    - it is a good idea to delete all not used key from a custom/config.ini
    - files at the depot in custom\winstskin\*.* will be copied to custom\winstskin\ at the client and will be used by opsi-winst since version
    - files at the depot  in custom\notifier\*.* will be overwrite the files at the clients notifier directory
    - a existing file at the depot: custom\opsiclientd.conf will overwrite the opsiconfd.conf files at the clients opsiclientd directory, which comes from the 'dist' directory

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Wed, 14 Nov 2012 09:00:00 +0100

[[opsi-403-releasenotes-misc-changelogs-python-opsi]]
==== Changelog python-opsi

python-opsi (4.0.3.1-1) testing; urgency=low

  * dhcp-backend: ddns-rev-domainname added to list where the values are written in double quotas
  * System: opsi-setup --init-current-config gives an warning instead of error, when vendor not found for network device
  * Posix:
    - saveImage returns the result from partclone if run was successfull.
    - readPartitionTable: Try to find out the right filesystem with blkid tool.
    - createPartition: allows linux as filesystem-type and produces partition with id 83
  * WindowsDriver: byAudit: Translating model and vendor from hwinvent: characters <>?":|\/* will be translated to _
  * python-opsi locale: danish added
  * compareVersion: fixed handling with versions from custom packages.
  * global.conf: fixed hostname entries
  * fixed resource directory listing for custom packages /repository
  * fix for ubuntu 12.10

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Tue, 05 Feb 2013 17:40:23 +0100

python-opsi (4.0.2.6-1) testing; urgency=low

  * Posix: getBlockDeviceControllerInfo():
    - if no devices attached on a AHCI-Controller (maybe a lshw or a kernel bug)
      try to find AHCI-Controller, if found try return the first found AHCI Controller
      for textmode-driverintegration (only for nt5)
  * Posix: modifications for newer ms-sys version
  * rpm-spec-file: noreplace option for dispatch.conf.default in files-section

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Mon, 07 Nov 2012 17:34:13 +0100

python-opsi (4.0.2.5-1) testing; urgency=low

  * fix in hwinvent procedure, don't crash if lshw don't work properly
  * fix for resizeNTFSPartition if blockAlignmnet is used (ntfs-restore-image)

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Fri, 02 Nov 2012 15:00:34 +0200

[[opsi-403-releasenotes-misc-changelogs-opsipxeconfd]]
==== Changelog opsipxeconfd

opsipxeconfd (4.0.3.1-1) stable; urgency=low

  * featurepack-release 4.0.3
  * this version is stable, because no changes were made, only version modified for new featurepack-release

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Thu, 14 Feb 2013 17:57:02 +0100

[[opsi-403-releasenotes-misc-changelogs-opsiconfd]]
==== Changelog opsiconfd

opsiconfd (4.0.3.1-1) testing; urgency=low

  * ressource: webstart jnlp build fixed for arguments.
  * added monitoring debug switch in opsiconfd.conf
  * fixed init-Script for using global.conf

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Tue, 05 Jan 2013 13:15:56 +0100

[[opsi-403-releasenotes-misc-changelogs-opsi-utils]]
==== Changelog opsi-utils

opsi-utils (4.0.3.1-1) testing; urgency=low

  * opsi-product-updater: Added Blank line between header and message-body to fix empty body mails on exchange environment.
  * opsi-product-updater: fix for handling with custom products.
  * opsi-admin: added new HostControlSafeBackend in BackendManager initialization.

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Tue, 12 Feb 2013 12:42:44 +0200

[[opsi-403-releasenotes-misc-changelogs-opsi-linux-bootimage]]
==== Changelog opsi-linux-bootimage

opsi-linux-bootimage (20130207-1) testing; urgency=low

  * added bc

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Fri, 01 Feb 2013 12:34:59 +0100

opsi-linux-bootimage (20130117-1) experimental; urgency=low

  * downgrade:
      ms-sys: 2.1.2
      kernel 3.6.11

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Wed, 17 Jan 2013 16:25:11 +0100

opsi-linux-bootimage (20130111-1) experimental; urgency=low

  * python-opsi 4.0.2.7-1
  * locale: danish and italian localisation added
  * kernel 3.7.1

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Fri, 11 Jan 2013 11:48:23 +0100

opsi-linux-bootimage (20121107-1) experimental; urgency=low

  * new ms-sys-version: 2.2.1

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Wed, 07 Nov 2012 17:51:31 +0100

opsi-linux-bootimage (20121105-1) experimental; urgency=low

  * python-opsi 4.0.2.6-1

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Mon, 05 Nov 2012 17:36:27 +0100

opsi-linux-bootimage (20121102-1) experimental; urgency=low

  * kernel 3.6.5
  * python-opsi 4.0.2.5-1

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Fri, 02 Nov 2012 15:11:43 +0100
 
opsi-linux-bootimage (20121024-1) unstable; urgency=low

  * kernel 3.6.3
  * python-opsi 4.0.2.5-1
  * added packages: cloop, cloop-utils, dmraid, rsync, partclone-utils, nbd-client, genisoimage

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Wed, 24 Oct 2012 12:57:00 +0200

opsi-linux-bootimage (20121011-1) experimental; urgency=low

  * kernel 3.6.1
  * python-opsi 4.0.2.4-1
  * Missing firmware from Broadcom-Chipsets added

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Thu, 11 Oct 2012 00:45:26 +0200

[[opsi-403-releasenotes-misc-changelogs-opsi-depotserver]]
==== Changelog opsi-depotserver

opsi-depotserver (4.0.3.1-1) testing; urgency=low

  * opsi-setup: added renew-opsiconfd-cert task
  * opsi-setup: added special files in set rights to add execute bit for these files in depot

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Mon, 28 Jan 2013 17:34:42 +0100

[[opsi-403-releasenotes-misc-changelogs-opsi4ucs]]
==== Changelog opsi4ucs

opsi4ucs (4.0.3.1-1) testing; urgency=low

  * join script: execute /usr/lib/univention-pam/ldap-group-to-file.py to resync the groups  (for ucs 3.1 support)
  * opsi-setup: set executebit for special opsi files in depot

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Tue, 05 Feb 2013 11:07:47 +0100

 
[[opsi-403-releasenotes-opsi-configed]]
==== Changelog opsi-configed

opsi-configed (4.0.3.1-1) testing; urgency=low

  * host config editing grouped by a tree
  * last change column for products now possible
  * the configed log files are now placed in the user home directory in a folder .configed
  * log panes now allow selection of displayed levels
  * log panes allow selection of event type if a log file has lines with event
  type specification
  * improved search handling in log panes
  * log panes, software and hardware audit panes can be copied into separated frames
  
 -- Rupert Roeder <r.roeder@uib.de>  Fri, 25 Jan 2013 12:00:00 +0200

 
  * search function for windows software panel
  * reset client selection when returning from server or depot editing
  * bugfix in mac address editing
  * configed checks if read only version is requested and, if wanted, produces it

 -- Rupert Roeder <r.roeder@uib.de>  Mon, 03 Dec 2012 12:00:00 +0200

 
opsi-configed (4.0.2.10-1) testing;  urgency=low

  * new logging format, included time check for service calls

 -- Rupert Roeder <r.roeder@uib.de>  Fri, 02 Nov 2012 12:00:00 +0200

 
 opsi-configed (4.0.2.8-1) testing;  urgency=low

  * check of transgression of activated client numbers
  * read only option 

 -- Rupert Roeder <r.roeder@uib.de>  Mon, 22 Oct 2012 12:00:00 +0200

opsi-configed (4.0.2.7-1) testing;  urgency=low

  * reopening a saved search

 -- Rupert Roeder <r.roeder@uib.de>  Mon, 15 Oct 2012 12:00:00 +0200

opsi-configed (4.0.2.7-1) testing;  urgency=low

  * more caching and less reloading actions

 -- Rupert Roeder <r.roeder@uib.de>  Mon, 15 Oct 2012 12:00:00 +0200
 

