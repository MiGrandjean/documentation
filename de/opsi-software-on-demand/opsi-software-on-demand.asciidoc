//// 
; Copyright (c) uib gmbh (www.uib.de)
; This documentation is owned by uib
; Until we found a better license:
; All rights reserved.
; credits: http://www.opsi.org/credits/
////

opsi Software On Demand (Kiosk-Mode)
====================================
Erol Ueluekmen <e.ueluekmen@uib.de>
:Date:      22.03.2011
:Revision:  4.0.0.1
:toc:
:numbered:
:website: http://opsi.org


include::../common/opsi_manual_software-on-demand.asciidoc[]

////
[[software-on-demand_introduction]]
== Einführung

Das Software-On-Demand-Modul bietet opsi-Administratoren die
Möglichkeit, ihren Anwendern eine Auswahl an Produkten zur Verfügung zu
stellen. Diese Produkte können vom Anwender, ohne Eingriff von einem
Administrator, ausgewählt und die Installation gestartet werden.
Diese Dokumentation soll die Funktionsweise des Software-On-Demand-Moduls
von opsi erläutern und einen Leitfaden bieten, wie man dieses
Modul konfigurieren und pflegen kann.

<<<

[[software-on-demand_prerequisits]]
== Vorbedingungen für das Modul

Als Erstes sei an dieser Stelle erwähnt, dass dieses Modul momentan eine
http://www.uib.de/www/kofinanziert/index.html[kofinanzierte opsi Erweiterung] ist. +
Es sind eine Reihe von Vorbedingungen nötig, um dieses Modul einsetzen
zu können. Zunächst werden Produkt-Gruppen benötigt, diese stehen erst
ab opsi 4.0 zur Verfügung. Weiterhin werden die Pakete
opsi-client-agent und opsi-configed ab Version 4.0.1 benötigt.

.Benötigte Pakete
[options="header"]
|==========================
|opsi-Paket|Version
|opsi-client-agent|>=4.0.1-3
|opsi-winst|>=4.10.8.12
|python-opsi|>=4.0.1-7
|opsi-depotserver|>=4.0.1-2
|opsi-configed|>=4.0.1.6-1
|==========================

Das Software-On-Demand Modul wurde auf folgenden Browsern getestet und freigegeben:

* Internet Explorer 8
* Mozilla Firefox 3.6.15

<<<

[[software-on-demand_configuration-parameter]]
== Konfiguration

Die Konfiguration dieses Moduls basiert auf Produktgruppen und Config-Variablen.
Die verwendeten Config-Variablen sind:

* software-on-demand.active
* software-on-demand.product-group-ids
* software-on-demand.show-details

Diese Config-Variablen werden beim Einspielen des opsi-depotserver-Pakets angelegt.

CAUTION: Bitte bedenken Sie die Mindestanforderung des opsi-depotserver-Pakets. +
(Siehe Kapitel: Vorbedingungen für das Modul)

Sollten die Config-Variablen nicht zur Verfügung stehen, können sie über `opsi-setup` erzeugt werden:

[source, prompt]
----
opsi-setup --init-current-config
----

[[software-on-demand_product-group-management]]
=== Produktgruppen pflegen

Am komfortabelsten kann man Produktgruppen mit dem opsi-configed anlegen und pflegen.
Dafür wechselt man zuerst auf den Tab _Produktkonfiguration_.

TIP: Seit Version 4.0.1.6 des _opsi-configed_ kann man direkt zur
Produktkonfiguration wechseln, ohne vorher einen Client auszuwählen.

Die Produktgruppen-Leiste befindet sich über der eigentlichen Produktliste.

.Ausschnitt von der Produktgruppen-Leiste
image::../images/configed_productgroup.png[]

Mit dem Dropdown-Feld kann man Produktgruppen auswählen, um sie zu bearbeiten.
Sobald eine Gruppe ausgewählt wurde, werden die dazugehörigen Produkte markiert. +
Mit dem zweiten Icon kann man die Filterfunktion ein-, bzw. ausschalten.
Bei aktiviertem Filter werden nur die Produkte angezeigt, die der gewählten Produktgruppe zugeordnet sind.
Zur Bearbeitung von Produktgruppen aktiviert man die erweiterte Ansicht durch Klick auf das Icon "Paketgruppen mit Diskette". 
In dieser Ansicht kann eine neue Gruppe, optional Beschreibung, angelegt werden.
Durch einen Klick auf den roten Haken, wird die neue Gruppe gespeichert. +
Die Zuordnung zur Produktgruppe kann durch Selektieren bzw. Deselektieren von Produkten in der Produktliste bearbeitet werden (Die Taste +<STRG>+ gedrückt halten und Produkte auswählen oder abwählen).

[[software-on-demand_configuration]]
=== Software-On-Demand-Modul konfigurieren

Mit Hilfe der bereits erwähnten Config-Variablen kann das _SoftwareOnDemand-Modul_ flexibel konfiguriert werden.
Folgende Tabelle zeigt eine Übersicht der Konfigurationen:

.Übersicht über die Config-Variablen des SoftwareOnDemand-Moduls
[options="header"]
|==========================
|Konfiguration|Beschreibung|Mögliche Werte
|software-on-demand.active|Aktiviert bzw. Deaktiviert das Modul.|true/false
|software-on-demand.product-group-ids|Produktgruppen mit Produkten, die für Software-On-Demand zur Verfügung stehen sollen.|Liste von Produktgruppen
|software-on-demand.show-details|Zeigt dem Anwender erweiterte Informationen an.|true/false
|==========================

Es gibt zwei Möglichkeiten diese Konfigurationsobjekte zu verwenden:
Systemweit oder pro Client. Die folgenden zwei Unterkapitel gehen auf
die zwei verschiedenen Konfigurationsmöglichkeiten näher ein.

[[software-on-demand_systemwide-configuration]]
==== Systemweite Konfiguration
Die Einstellungen gelten systemweit als Vorgabe für jeden Client.

Die Konfigurationen können im _opsi-configed_ im Modul Servereigenschaften im Tab Host-Parameter bearbeitet werden.

.Ausschnitt von Serverkonfigurations-Modul des configed
image::../images/configed_serverconfiguration.png[]

<<<

Alternativ kann man die Konfigurationen auf dem Server mittels des folgenden Befehls anpassen:

[source, prompt]
----
opsi-setup --edit-config-defaults
----

.Ausschnitt von edit-config-defaults über opsi-setup
image::../images/editconfigdefaults.png[]

TIP: Natürlich ist eine Bearbeitung auch über die opsi-python-API oder über `opsi-admin` möglich.

[[software-on-demand_client-configuration]]
==== Client-spezifische Konfiguration

Die Client-spezifische Konfiguration macht dann Sinn, wenn zum Beispiel nur ein Teil der opsi-Clients
Zugriff auf dieses Modul haben soll, oder wenn man verschiedenen Clients unterschiedliche Produktgruppen zur Verfügung stellen will.

Dies erreicht man durch die Konfiguration von Client-spezifischen Host-Parametern.
Diese kann man wiederum auf verschiedenen Wegen bearbeiten.
Die komfortabelste Möglichkeit diese Konfiguration zu bearbeiten, bietet der opsi-configed.
Dafür wählt man im opsi-configed einen oder mehrere Clients (eventuell auch alle Clients einer Clientgruppe) und wechselt auf den Tab Host-Parametern.

.Ausschnitt von Host-Parametern
image::../images/configed_hostparameter.png[]

Diese Einstellungen überschreiben die systemweiten Vorgaben.

[[software-on-demand_event-configuration]]
=== opsiclientd Event-Konfiguration

Beim Installieren von Produkten über das Software-On-Demand-Modul stehen dem Anwender zwei Möglichkeiten zur Verfügung, die Installation zu starten:

* beim nächsten Systemstart ausführen
* sofort ausführen

Wählt der Benutzer an dieser Stelle die Möglichkeit _beim nächsten Systemstart ausführen_, werden die Produkte nur auf _setup_ gesetzt.
Wird _sofort ausführen_ gewählt, erzeugt der _opsiclientd_ ein Event vom Typ _software on demand_.
Dieses Event kann, wie jedes andere Event auch, in der `opsiclientd.conf` konfiguriert werden.
In der im _opsi-client-agent_ enthaltenen `opsiclientd.conf` ist bereits eine Konfiguration enthalten, die angepasst werden kann.

[[software-on-demand_CI]]
=== Anpassung an Corporate Identity

Das Erscheinungsbild im Browser des Software-On-Demand-Moduls kann an die firmeneigene Corporate Identity angepasst werden. Dazu muss die CSS-Datei: _opsiclientd.css_ angepasst werden. Auf dem Client liegt diese Datei unter:

_C:\Programme\opsi.org\opsi-client-agent\opsiclientd\static_html_

Diese kann durch editieren und neu laden angepasst werden. Diese Änderung muss auf den Server kopiert werden, um bei Neuinstallationen des opsi-client-agenten die Änderungen mit zu verteilen. Dazu muss die CSS-Datei und eventuell die Logo-Datei auf den Server ins Verzeichnis:

_/opt/pcbin/install/opsi-client-agent/files/opsi/dist/opsiclientd/static_html_

kopiert werden. Ein nachträgliches Rechte nachziehen hilft Folgefehler zu vermeiden:

[source, prompt]
----
opsi-setup --set-rights /opt/pcbin/install/opsi-client-agent
----

CAUTION: Die Änderungen werden momentan nicht gesichert und würden bei einer Neuinstallation des opsi-Pakets opsi-client-agent überschrieben werden. Bitte denken Sie daran, die Dateien vor einem Upgrade zu sichern.


[[software-on-demand_usage]]
== Verwendung

Das Software-On-Demand-Modul stellt über den `opsiclientd` eine Webanwendung zur Verfügung. Diese ist über den jeweiligen Clients unter der URL https://localhost:4441/swondemand erreichbar.

Wenn der opsi-client-agent während der Installation merkt, dass die Konfiguration: _software-on-demand.active_ auf _true_ gesetzt wurde, wird automatisch während der Installation auf dem Client ein Startmenü-Eintrag erstellt, über den die Webanwendung direkt aufgerufen werden kann. Diesen findet man dann unter: _Start -> Programme -> opsi.org -> software-on-demand_. Über diesen Startmenü-Eintrag wird der Standardbrowser mit der oben genannten URL aufgerufen.

Die Anzeige wird beeinflusst durch die Konfiguration vom _software-on-demand.show-details_. Durch diese Konfiguration werden entweder nur minimale bzw. viele Eigenschaften der Produkte gezeigt.

Auf das Modul kann auch über das Netzwerk zugegriffen werden, hierbei ist jedoch eine Authentifizierung notwendig.

.Ausschnitt von der Übersichtsseite von Software-on-demand
image::../images/opsi-software-on-demand_overview.png[]

Aus der Liste, die angezeigt wird, kann sich der Anwender die Software aussuchen und zum Installieren auswählen; dies geschieht über die Aktivierung der Checkbox: _installieren_. Wenn die Software schon installiert war, wird _neu installieren_ und zusätzlich _deinstallieren_ zur Auswahl gestellt. (Abhängige Pakete, die eventuell über die Abhängigkeitssteuerung von opsi mit installiert wurden, werden bei dieser deinstallation nicht mit deinstalliert, da in diesem Zustand nicht hundert prozentig festgestellt werden kann, ob die Abhängigkeit nur dieses Paket betrifft.)

Nach dem die Auswahl abgschlossen wurde, kommt man durch den Button: _weiter_ auf die nächste Seite.

Auf der nächsten Seite wird eine Übersicht über die anstehenden Aktionen angezeigt, auch diese Seite ist über die Konfiguration von _software-on-demand.show-details_ beeinflussbar. Wenn diese Konfiguration auf _true_ steht, wird neben der Auswahl des Anwenders noch zusätzlich angezeigt, welche Pakete über eine Abhängigkeit auf setup gesetzt wurden und welche Pakete schon auf setup standen.

.Ausschnitt von der Übersichtsseite der anstehenden Aktionen
image::../images/opsi-software-on-demand_actions.png[]

Wie man oben im Ausschnitt erkennen kann, hat man nun drei Auswahlmöglichkeiten. Zu diesem Zeitpunkt wurden die Änderungen noch nicht an den opsi-Service übertragen. Hier hat man noch die Möglichkeit mit dem Button: _zurück_ auf die Übersichtsseite zurück zu wechseln, um die Auswahl anzupassen.
Der Button _beim nächsten Systemstart ausführen_ schickt die Änderungen an den opsi-Service weiter und die Änderungen werden für den nächsten Systemstart vorgemerkt.
Der Button _sofort ausführen_ löst das oben genannte Event aus und die Installationen werden anhand der Eventkonfiguration sofort ausgeführt.

== Besonderheiten

Folgende Besonderheiten gelten für das Software-On-Demand Modul:

* Abhängigkeiten werden automatisch aufgelöst +
   - Software, die von Software aus der Demand-Gruppe abhängig ist, wird automatisch falls benötigt auf setup gesetzt, ohne Einfluss des Anwenders.
* Software die schon auf setup steht +
   - In diesem Fall, wird die Checkbox: _installieren_, schon bei der Übersichtsseite aktiviert.
////












