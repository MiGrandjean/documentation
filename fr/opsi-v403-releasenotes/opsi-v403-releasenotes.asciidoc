////
; Copyright (c) uib gmbh (www.uib.de)
; Cette documentation appartient à uib
; et publié sous licence Creative Commons by-sa allemande
; voir:
; http://creativecommons.org/licenses/by-sa/3.0/de/
; http://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; anglais:
; http://creativecommons.org/licenses/by-sa/3.0/
; http://creativecommons.org/licenses/by-sa/3.0/legalcode
; 
; credits: http://www.opsi.org/credits/
////


:Author:    Opensides sprl
:Email:     opsi@opensides.be
:Date:      26.02.2013
:Revision:  4.0.3
:doctype:		book

// Include common opsi terms
include::../common/opsi_terms.asciidoc[]

= Opsi 4.0.3 Notes de version

// Include common opsi copyright
include::../common/opsi_manual_copyright.asciidoc[]

[[opsi-403-releasenotes-overview]]
== Vue d'ensemble des nouvelles fonctionnalités

La release 4.0.3 est riche en nouvelles fonctionnalités et améliorations.

* extension opsi: Installation lors de l'arrêt

* fonctionnalité opsi: installation silencieuse

* Localisation italien et danois

* Support pour les distributions suivantes:

** UCS 3.1
** Ubuntu 12.10

Le guide d'installation se trouve dans le manuel 'opsi-getting-started'.

* L'arrêt à la fin de Mars 2013 du support pour:

** CentOs 5
** RedHat 5
** OpenSuse 11.3 / 11.4

* opsi-client-agent

** Version largement révisée
** Version Open Source de l'extension opsi: Sélection dynamique du dépôt
** extension opsi: Installation lors de l'arrêt
** fonctionnalité opsi: installation silencieuse
** Amélioration de la personnalisation
** Adaptations pour le support de Windows 8 
** Gestion de session révisée: une meilleure identification des comptes d'utilisateurs.
** Améliorations pour le support WAN
** plusieurs corrections

* composants du serveur opsi

** Amélioration du Backend DHCP
** Nouveau Backend HostControlSafe
** Génération du certificat SSL webservice par l'intermédiaire de opsi-setup

* Produits Windows Netboot

** Support Windows 8 / Server 2012
** Amélioration de la procédure byAudit
** Taille de la partition WinPE configurable
** Nouvelle propriété data_partition_create: la partition de données sera créée s'il existe un espace disque disponible (true/false; par défaut: true).
** Support UEFI
** Prise en charge de RAID 1 logiciel: Nouvelle propriété 'useRaid1' gère 2 disques existants de la même façon.

* opsi-winst: +
Un grand nombre de nouvelles fonctionnalités, qui sont décrits en détail plus bas.

* Changement de la licence depuis GPLv3 vers AGPLv3: +
Avec la release 4.0.3 nous allons passer à AGPLv3. +
Ce changement du type de licence ne concerne que les entreprises, qui distribuent opsi dans le cadre d'un produit à code source fermé.
Quiconque a besoin d'une licence pour vendre opsi dans le cadre d'une solution à code source fermée peut nous contacter.

Pour plus de détails s'il vous plaît consulter le document opsi-v403-releasenotes et les manuels révisés d'opsi.

[[opsi-403-releasenotes-eol]]
== Cessation

Dans ce chapitre sont répertoriés les abandons. Ces versions de distribution, par différentes raisons, ne seront plus prises en charge par opsi.

[[opsi-403-releasenotes-eol_python24]]
=== Cessation du support de Python 2.4

Avec cette version le soutien officiel de Python 2.4 est interrompue. Cela concerne les distributions: Redhat 5 et Centos 5. Les dépôts concernés seront fermés à la fin de Mars 2013. Les versions finales des paquets seront disponibles à partir de l'archive download.uib.de. Pour les installations opsi concernés, nous vous recommandons la mise à niveau vers les nouvelles versions des distributions, qui sont toujours pris en charge.

[[opsi-403-releasenotes-eol_distros]]
=== Cessation des versions de distribution Linux

Les versions suivantes de distributions Linux ne sont plus supportées en raison de l'entretien insuffisant par le distributeur:

** openSuse 11.3
** Ubuntu 10.10
** Ubuntu 11.04
** Ubuntu 11.10

Ces dépôts seront fermés à la fin de Mars 2013. Pour les installations basées sur ces versions de distribution, nous recommandons fortement une mise à niveau du système d'exploitation. Mais avant de le faire, vérifiez si la version choisie est soutenue par opsi.

[[opsi-403-releasenotes-installation]]
== Remarques sur l'installation

Les produits contenus dans ce communiqué en plusieurs parties dépendent les unes des autres. Donc installez tous ses morceaux et n'essayez pas d'installer seulement certaines parties.

Vous devez mettre à jour d'abord le serveur, puis les produits opsi.

Pour installer les paquets de la version de test hangez le dépôt opsi de 'opsi40' vers 'opsi40-testing'. +
Par exemple pour Ubuntu 12.04: +
`deb http://download.opensuse.org/repositories/home:/uibmz:/opsi:/opsi40/xUbuntu_12.04 ./` +
il faut le remplacer par: +
`deb http://download.opensuse.org/repositories/home:/uibmz:/opsi:/opsi40-testing/xUbuntu_12.04 ./`

Puis mettez à jour vos paquets. +
Par exemple pour Ubuntu / Debian:
[source,prompt]
----
aptitude update
aptitude dist-upgrade
----

Pour l'installation des produits opsi de test:
[source,prompt]
----
cd /home/opsiproducts
mkdir opsi403
cd opsi403
wget -r -l1 -nc -nd -A "*.opsi" http://download.uib.de/opsi4.0/testing/opsi403/products/
opsi-package-manager -i *.opsi
----
Si la commande wget devrait échouer, vous pourriez avoir à régler la variable environnementale http_proxy avec un adresse proxy valide (ex. http_proxy=http://192.168.1.5:8080/)


////
L'installation ne nécessite pas de procédures spéciales et peut se faire dans le cadre de la mise à jour standard du serveur et des produits opsi.

Comme première étape, vous devez faire une mise à jour du serveur, puis installer les produits opsi. Ce qui doit être fait avec opsi-product-updater:

[source,prompt]
----
opsi-product-updater -i -vv
----
////
Dans le cas où vous disposez d'une installation à plusieurs dépôts, mettez à niveau d'abord le serveur de configuration, puis les serveurs dépôt.

CAUTION: Depuis opsi 4.0.3 nous avons supprimé les dépendances des paquetages 'dhcp server' et 'java runtime environment' du serveur opsi. +
Nous avons fait ces changements, parce que la plupart de nos clients utilisent un autre serveur dhcp et n'ont pas besoin d'exécuter opsi-configed directement sur le serveur OPSI. +
Ceci mène à une désinstallation automatique de ces paquets s'ils ont été installées avant par la dépendance opsi. +
Si vous avez besoin d'un de ces paquets sur votre serveur opsi, vous devez vérifier et (si nécessaire) réinstaller ces paquets après mise à jour vers opsi 4.0.3.

include::../common/opsi_manual_on_shutdown.asciidoc[]
include::../common/opsi_manual_silentinstall.asciidoc[]


[[opsi-manual-clientagent-ci-custom]]
== Protect your CI changes from updates: le répertoire custom

(disponible depuis la version opsi-client-agent 4.0.2.3)

Le répertoire custom peut être utilisé pour protéger vos modifications de configuration au cours des mises à jours de opsi-client-agent: (`/opt/pcbin/install/opsi-client-agent/files/opsi/custom`). Au cours de mises à jour de opsi-client-agent sur le serveur, le répertoire custom sera sauvegardé et restauré après la mise à jour, afin que vos modifications persistent.

* `custom/cfg/config.ini` +
Les valeurs de ce fichier de configuration, remplacent les valeurs par défaut de `cfg/config.ini`. À l'exception des valeurs de `pckey` et `bootmode`, qui ne sont pas repris à partir de ce fichier. Ajoutez à votre fichier de configuration personnalisée *uniquement* ces valeurs, qui sont différents des paramètres par défaut.

* `custom/winstskin/*.*` +
Tous les fichiers de ce répertoire seront copiées vers les clients, dans le répertoire `C:\Program Files (x86)\opsi.org\opsi-client-agent\custom\winstskin` lors de l'installation de opsi-client-agent sur ​​le client. Ce répertoire `winstskin`, s'il existe, depuis la version 4.11.3.4 de opsi-winst, est le préféré. Il doit contenir tous les fichiers et les configurations nécessaires de winstskin, pour que le contenu du répertoire par défaut soit ignorée. 

* `custom/notifier/*.*` +
Tous les fichiers de ce répertoire seront copiées vers les clients, dans le répertoire `C:\Program Files (x86)\opsi.org\opsi-client-agent\notifier` lors de l'installation de opsi-client-agent et remplaceront les fichiers côté serveur du répertoire `files/opsi/dist/notifier/`. 

* `custom/opsiclientd.conf` +
S'il existse, `custom/opsiclientd.conf` sera copié sur les clients, dans le répertoire `C:\Program Files (x86)\opsi.org\opsi-client-agent\opsiclientd` lors de l'installation de opsi-client-agent et remplacera le fichier par défaut opsiclientd.conf du répertoire `files/opsi/dist/opsiclientd/` sur le serveur. Ainsi, le fichier personnalisé opsiclientd.conf doit contenir *tous* les entrées de configuration nécessaires. +
*Attention:* +
L'utilisation d'un fichier personnalisé `opsiclientd.conf` n'est pas recommandée. Pour personnaliser la configuration de votre client, utilisez le paramètre de configuration hôte pour les fonctions simples telles que décrites dans le chapitre opsi-client-agent. L'utilisation d'un fichier personnalisé `opsiclientd.conf` s'applique seulement pour les configurations très complexes. En utilisant un fichier personnalisé `opsiclientd.conf`, après chaque mise à jour de opsi-client-agent, sera nécessaire vérifier sur le serveur le fichier par défaut `files/opsi/dist/opsiclientd/opsiclientd.conf` pour apporter les nécessaires corrections dans votre fichier personnalisé `opsiclientd.conf`. +
 *Donc: les mains au large de cette fonction, sauf si vous savez vraiment ce que vous faites!*
 

[[opsi-403-releasenotes-driverintegration]]
== Adaptations des méthode byAudit pour l'intégration des drivers

Certains fabricants utilisent des codes d'identification de modèles comprenant des caractères spéciaux, qui ne peuvent pas être utilisés dans les noms de fichiers et de répertoires. Par exemple, une identification du modèle : "5000/6000/7000". Le slash ne peut pas être utilisé pour les noms de répertoires valides. Donc depuis la release opsi 4.0.3 les caractères spéciaux suivants: < > ? " : | \ / * intérieurement seront remplacés par un trait de soulignement '_' . Ainsi, l'exemple précédent, sera remplacé par : "5000_6000_7000" et le répertoire sera automatiquement attribué, bien que les informations contenues dans l'inventaire matériel différent.

[[opsi-manual-backends-hostcontrolsafe]]
== Backend HostControlSafe

Le comportement par défaut des méthodes opsi4.0, lorsqu'elles sont appelées sans aucun paramètre, c'est qu'elles correspondent à tous les objets existants. Par exemple, la commande "host_getObjects", sans aucun paramètre, retournera tous les objets host. Cela pourrait être dangereux lorsque vous utilisez le backend HostControl. Surtout avec des commandes comme: "hostControl_shutdown" et "hostControl_reboot". Dans ces cas, l'appel de la méthode sans paramètre ferait arrêter ou redémarrer tous les clients.

Donc opsi 4.0.3 est livré avec deux changements:

* Les méthodes: "hostControl_shutdown" et "hostControl_reboot" n'ont plus le comportement standard et elles entraîneront un message d'erreur lorsqu'elles seront appelées sans aucun paramètre.
* Un nouveau backend est introduit: HostControlSafe Backend, qui lance un message d'erreur pour l'ensemble des méthodes, si elles sont appelées sans aucun paramètre client. Pour traiter explicitement tous les clients par une méthode HostControlSafe-Backend, le joker * peut être utilisé:

[source,prompt]
----
opsi-admin -d method hostControlSafe_shutdown *
----

Donc, pour les raisons mentionnées ci-dessus, nous vous recommandons d'utiliser les méthodes hostControlSafe à la console. Surtout si vous avez peu d'expérience dans l'utilisation des méthodes de service.


[[opsi-winst]]
== opsi-winst 4.11.3.5

Les descriptions qui suivent sont extraits du manuel '{opsi-winst}'.

"(...)" marque les parties omises.

[[opsi-winst-skins]]
=== Customisation {opsi-winst}

Depuis la version 3.6 de '{opsi-winst}' le GUI peut être personnalisé. Les éléments de personnalisation se trouvent dans le sous-répertoire winstskin du répertoire '{opsi-winst}'. Le fichier de configuration pour la personnalisation est `skin.ini`. 

Depuis la version 4.11.3.5 the '{opsi-winst}' recherche le répertoire skin dans l'ordre suivant (le premier répertoire avec un `skin.ini` qui est trouvé gagne):

. `%WinstDir%\..\custom\winstskin`
. `%WinstDir%\winstskin`

Avec la commande `SetSkinDirectory` le répertoire d'habillage à utiliser peut être défini dans le script. Si le chemin d'accès spécifié est vide ou non valide, le chemin par défaut sera utilisé.

Exemple:
[source,winst]
----
SetSkinDirectory "%ScriptPath%\testskin"
sleepseconds 1
SetSkinDirectory ""
----

[[opsi-winst-params-showmode]]
==== Mode Fenêtre / Skin

* `SetSkinDirectory` <répertoire-skin>
définit le répertoire à utiliser pour le skin et charge le skin. Si le chemin d'accès spécifié est vide ou non valide, le chemin par défaut sera utilisé.

Exemple:
[source,winst]
----
SetSkinDirectory "%ScriptPath%\testskin"
sleepseconds 1
SetSkinDirectory ""
----


[[opsi-winst-commands-logging]]
=== Commandes pour contrôler la journalisation

(...)

* `SetConfidential` <chaîne secrète> +
Cela empêche à des informations confidentielles (comme les mots de passe) d'être enregistré dans les logs. Dans le fichier de log les informations confidentielles seront remplacés par '"***(confidential)***"'. +
Lorsque le niveau de journalisation est défini sur '9', les informations confidentielles seront enregistrées. +
(depuis la version 4.11.3.5)

Exemple:
[source,winst]
----
message "SetConfidential"
SetConfidential "forbidden"
comment "This is a forbidden string"
comment "shown in the should be in the log file: This is a ***(confidential)*** string"
----
Log:
[source,winst]
----
message SetConfidential
comment: This is a ***(secret)*** string
comment: should be in the log file: This is a ***(confidential)*** string
----


[[opsi-winst-numbers]]
=== Calcul avec des nombres

Les scripts 'opsi-winst' n'ont pas un type spécial de variables pour des nombres. Mais il y a certaines fonctions pour aider à calculer avec des nombres.

* `calculate(`<chaîne>`)` +
cette fonction de chaîne, calcule l'expression arithmétique de la chaîne <chaîne> et renvoie le résultat nombre entier comme une chaîne. +
En interne, les calculs sont effectués avec des nombres réels. Cette fonction accepte les opérateurs `+`, `-`, `*`, `/` et les parenthèses `(`,`)`. +
En cas d'erreur, une chaîne vide est retournée et le compteur d'erreurs est incrémenté. Si la chaîne passée contient des caractères autres que des chiffres, des opérateurs valides et des parenthèses, il en résulte une erreur. +
Si le second opérande est manquant, le premier opérande est également pris comme deuxième opérande: 5+ = 10 ; 5* = 25. Ainsi, les chaînes qui sont utilisées pour assembler l'argument doivent être validées par la fonction `isNumber`. +
(depuis la version 4.11.3.5)

Exemple:
[source,winst]
----
set $ConstTest$ = "0"
set $CompValue$ = calculate("-1+1")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $ConstTest$ = "1"
set $CompValue$ = calculate("0+1")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $ConstTest$ = "-1"
set $CompValue$ = calculate("0-1")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "5"
set $ConstTest$ = "25"
set $CompValue$ = calculate($string1$+"*"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "5"
set $ConstTest$ = "1"
set $CompValue$ = calculate($string1$+"/"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "0"
set $ConstTest$ = ""
comment " expecting division by zero error and empty string result"
set $CompValue$ = calculate($string1$+"/"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "9"
set $string2$ = "10"
set $ConstTest$ = "1"
comment "result 0.9 is rounded to 1 "
set $CompValue$ = calculate($string1$+"/"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "10"
set $string2$ = "9"
set $ConstTest$ = "1"
comment "result 1.1111 is rounded to 1 "
set $CompValue$ = calculate($string1$+"/"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "5"
set $ConstTest$ = "55"
comment " rule * before +"
set $CompValue$ = calculate($string1$+"+"+$string2$+"*10")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "5"
set $ConstTest$ = "100"
comment "brackets before  rule * before + "
set $CompValue$ = calculate("("+$string1$+"+"+$string2$+")*10")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "ten"
set $ConstTest$ = ""
comment "invalid char error"
set $CompValue$ = calculate($string1$+"*"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = ""
set $ConstTest$ = "25"
comment "5* is interpreted as 5*5"
set $CompValue$ = calculate($string1$+"*")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = ""
set $ConstTest$ = "10"
comment "5+ is interpreted as 5+5"
set $CompValue$ = calculate($string1$+"+")
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "nothing"
set $string2$ = "foo"
set $ConstTest$ = ""
comment "invalid char error"
set $CompValue$ = calculate($string1$+"*"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
set $string1$ = "5"
set $string2$ = "foo"
set $ConstTest$ = ""
comment "invalid char error"
set $CompValue$ = calculate($string1$+"/"+$string2$)
if ($ConstTest$ = $CompValue$)
	comment "passed"
else
	set $TestResult$ = "not o.k."
	LogWarning "failed"
endif
----
Pour plus d'exemples faites référence au produit 'opsi-winst-test'
à la section '$Flag_calculate$ = "on"'

[[opsi-winst-patchtextfile]]
=== Sections PatchTextFile

[[opsi-winst-patchtextfile-params]]
==== Paramèters

Le nom du fichier à patcher est passé en paramètre.

Les modificateurs optionnels sont:

* `/AllNTUserProfiles` +
Si une section 'PatchTextFile' est appelée avec ce modificateur et le chemin du fichier à patcher contient la constante `%UserProfileDir%`, la section patch sera exécutée pour tous les profils. +
Pour une section 'PatchTextFile', qui est appelé à partir d'une section `[ProfileActions]` dans le mode 'Machine', le modificateur `/AllNTUserProfiles` est implicite. Dans le mode 'Loginscript', `%UserProfileDir%` est interprété comme `%CurrentProfileDir%`. +
(depuis la version 4.11.3.5)


[[opsi-winst-linkfolder]]
=== Sections LinkFolder

(...)

Dans une section 'LinkFolder' d'abord doit être défini dans quel dossier système virtuel les instructions subséquentes sont conçus pour fonctionner. Cette expression définit le dossier de base: +
`set_basefolder` '<virtual system folder>' 

Les dossiers système virtuels à utiliser sont:

'desktop, sendto, startmenu, startup, programs, desktopdirectory, common_startmenu, common_programs, common_startup, common_desktopdirectory'

Ces dossiers sont virtuels, car ils dépendent du système d'exploitation (et de la  version), le nom du répertoire physique qui en résulte.

Dans le cadre d'installations standard 'machine' , seuls les dossiers système virtuel en commençant par `common_` sont pertinentes.

Les dossiers système 'desktop, sendto, startmenu, startup, programs, desktopdirectory' peuvent uniquement être utilisés dans le cadre d'un utilisateur connecté respectivement dans un 'userLoginScript' dans le cadre de l'extension opsi 'user Profile Management'.

[[opsi-winst-execwith]]
=== Sections ExecWith

[[opsi-winst-execwith-params]]
==== Paramètres d'appel (Modificateur)

(...)

Les suivantes options '{opsi-winst}' sont disponibles:

*  `/32Bit` +
C'est la valeur par défaut. Le chemin de l'interpréteur est supposé être un chemin 32 bits. +
Exemple: `c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe` appelle (aussi lorsqu'il est exécuté sur un système 64 bit) le 'powershell.exe' 32 bit.

*  `/64Bit` +
Le chemin de l'interpréteur est supposé être un chemin 64 bits. +
Exemple: `c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe` appelle (dans un système 64 bit) le 'powershell.exe' 64 bit.

*  `/SysNative` +
Le chemin de l'interpréteur est attribué en fonction de l'architecture OS. +
Exemple: `c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe` appelle (dans un système 64 bit) le 'powershell.exe' 64 bit et dans un système 32bit le 'powershell.exe' 32 bit.

Depuis la version 4.11.3.5, si le chemin de l'interpréteur contient 'powershell.exe', le fichier temporaire est enregistré avec l'extension `.ps1`. 

[[opsi-winst-winbatch]]
=== Sections WinBatch

[[opsi-winst-winbatch-params]]
==== Paramètres d'appel (Modificateur)

*  `/32Bit` +
C'est la valeur par défaut. Le chemin de l'interpréteur est supposé être un chemin 32 bits. +
Exemple: `c:\windows\system32\regedit.exe` exécute (même lorsqu'il est exécuté sur un système 64 bits) 'regedit.exe' 32 bit.

*  `/64Bit` +
Le chemin de l'interpréteur est supposé être un chemin 64 bits. +
Exemple: `c:\windows\system32\regedit.exe` exécute (exécuté dans un système 64 bit) 'regedit.exe' 64 bit.

*  `/SysNative` +
Le chemin dans cette section est attribué en fonction de l'architecture OS. +
Exemple: `c:\windows\system32\regedit.exe` exécuté dans un système 64 bit appelle 'regedit.exe' en 64 bit et exécuté dans un système 32 bit appelle 'regedit.exe' en 32 bit.

Exemple:
[source,winst]
----
Winbatch_add_reg winst /64Bit
[Winbatch_add_reg]
"c:\windows\system32\regedit.exe" /s "%scriptpath%\my64.reg"
----

* `/RunAsLoggedonUser` //since 4.11.3.5 +
Cette option est disponible uniquement dans le cadre de 'userLoginScripts'. Le programme est exécuté en tant qu'utilisateur qui vient de se connecter.
Ce modificateur a les limites suivantes: +
** peu testé sur NT6.

[[opsi-winst-ldapsearch]]
=== Section LDAPsearch

[[opsi-winst-ldapsearch-syntax]]
==== Syntaxe section LDAPsearch

Une section LDAPsearch présente les caractéristiques suivantes:

(...)

*  `user:` +
nom d'utilisateur à appliquer. Depuis 4.11.3.5

*  `password:` +
mot de passe d'utilisateur à appliquer. Depuis 4.11.3.5

(...)

[[opsi-winst-ldapsearch-examples]]
==== Exemples

(...)

Exemple avec utilisateur / mot de passe
[source,winst]
----
comment ""
comment "-------------------------------------"
comment "Testing: "
comment "user / password"
Set $LdapHost$ = "vmix7.uib.local"
Set $LdapPort$ = "389"
Set $LdapUser$ = "cn=Administrator,cn=Users,dc=uib,dc=local"
Set $LdapPassword$ = "Linux123"
Set $LdapResultType$ = "objects"
Set $LdapSearchDn$ = "cn=Users,dc=uib,dc=local"
Set $LdapSearchAttributes$ = "name,objectClass"
Set $LdapFilter$ = "(&(objectclass=*))"

markErrorNumber
set $list1$ = getReturnListFromSection("ldapsearch_users /" + $LdapResultType$)
if errorsOccuredSinceMark > 0
	comment "failed while ldapsearch"
	set $TestResult$ = "not o.k."
else
	comment "passed"
endif

[ldapsearch_users]
targethost: $LdapHost$
targetport: $LdapPort$
user: $LdapUser$
password: $LdapPassword$
dn: $LdapSearchDn$
attributes: $LdapSearchAttributes$
filter: $LdapFilter$
----

[[opsi-configed]]
== opsi-configed 4.0.3.1

[[opsi-manual-configuration-tools-opsi-configed-hostproperties]]
=== Paramètres de l'hôte dans la configuration client et serveur

Pour un meilleur aperçu, les paramètres de l'hôte sont maintenant divisés en groupes fonctionnels. 
Les groupes sont affichées sur le côté gauche, comme un arbre. Les paramètres et les valeurs du groupe sélectionné sont affichées sur le côté droit.

.'{opsi-configed}': Onglet paramètres de l'host (configuration serveur et client)
image::../images/opsi-configed-hostparameters.png["{opsi-configed}: Onglet paramètres de l'host (configuration serveur et client)", width=400]


[[opsi-manual-configuration-tools-opsi-configed-logfiles]]
=== Fichiers de log

Le niveau des entrées de log qui doit être représentée peut-être sélectionnée par une glissière, il est donc plus facile de trouver des erreurs. La glissière peut également être déplacé à l'aide de la molette de la souris.

Les logs se rapportant à un événement peuvent être sélectionnés.

.'{opsi-configed}': Onglet fichiers de log
image::../images/opsi-configed-logfiles.png["{opsi-configed}: Onglet fichiers de log", width=400]

[[opsi-403-releasenotes-misc]]
== Miscellaneous

[[opsi-403-releasenotes-misc-externalReferences]]
=== Les références au manuel opsi

Certains chapitres des notes de version font également partie du 'manuel de opsi' et se référer à d'autres chapitres du 'manuel de opsi'. Les chapitres visés sont:

[[opsi-manual-modules]]
==== Activation du module de gestion des licences
Plus d'informations sur l'activation du module de gestion des licences se trouvent dans le 'manuel de opsi' dans le chapitre correspondant aux des modules d'extension.

[[opsi-manual-clientagent-configuration-webservice]]
==== Configuration par le service Web ({opsi-config-object})
Plus d'informations sur la configuration du service Web se trouvent dans le 'manuel de opsi' dans le chapitre correspondant à la configuration de l'agent du client. 

[[opsi-403-releasenotes-misc-changelogs]]
=== Changelogs:


[[opsi-403-releasenotes-misc-changelogs-opsi-winst]]
==== Changelog de opsi-winst

opsi-winst (4.11.3.6) stable; urgency=low

  * fix: no [productId] while listing of products
  
-- Detlef Oertel <d.oertel@uib.de>  Thu,  11 Mar 2013:15:00:00 +0200

opsi-winst (4.11.3.5) stable; urgency=low

  * del / delete will not delete if the given Filename starts with '\' (eg. '\Dummy')
  * danish localization added
  * italien localization added
  * extended LDAPSearch (username/password)
  * fix: do not store isfatalerror in registry if nor running as admin
  * execwith: winst (/32bit|/64bit|/sysnative) no allowed
  * execwith: if 'powershell.exe' is part of the interpreter string the script extension is '.ps1'
  * winbatch: /32bit|/64bit|/sysnative no allowed
  * wilog: replace ' -->' by ' ==>' because the opsi web service get in trouble because it is interpreted as xml comment, fixes #350
  * switch to Lazarus 1.0 / fpc 2.6.0
  * wisynt: doAktionen, fileActionsMain: do ApplyTextConstants for filesections in fileActionsMain.
      fixes wrong resolution of %CurrentProfileDir% in Files /AllNTuserProfiles
  * wisynt: doLinkFolderActions: fix: now comments allowed between set_link and end_link
  * wisynt: doLinkFolderActions: linkfolder section now  usable in userLoginScripts:
      the predefined basfolders:
      'desktop', 'sendto', 'startmenu', 'programs', 'startup', 'desktopdirectory'
      are pointing to the loggedin user directories if called from userLoginScript
  * wimain: ProcessNonZeroScript: fix: do not run update after setup if setup is failed, fixes #432
  * fix: widatamodul: opsidata4.initproduct now boolean function: false = error
  * new: new winst cli parameter '/productlist <productid>[,<productid>]* as sub parameter to /opsiservice
    try to run the setup-scripts of the given products, change installation states, send log files
  * new: string function calculate(<string expr>) ; calculates the mathematical expression and returns the result as string.
    on error the result is a empty string and the errorcounter is increased
  * new command 'setConfidential <confidential string>' ;
       adds the given string to a list of strings which are replaced with '***(confidential)***' while logging

-- Detlef Oertel <d.oertel@uib.de>  Thu,  05 Dec 2012:15:00:00 +0200


opsi-winst (4.11.3.4) stable; urgency=low

  * new winbatch parameter /RunAsLoggedOnUser
  * PatchTextFile sections may now called with  %userprofiledir% as part of the file name and /AllNTuserProfiles
     so it will run on all profiles.
     If running in Machine mode, the '/AllNTuserProfiles' is implizit in the [ProfileActions].
     If running in LoginScript mode, the '%userprofiledir%' is the %CurrentProfileDir%.
  * will now look for skins (more exactly: skin.ini) in the following sequence:
    1) by parameter
    2) new custom directory of opsi-client-agent ../custom/winstskin
    3) own winstskin: winstskin

-- Detlef Oertel <d.oertel@uib.de>  Thu,  26 Oct 2012:15:00:00 +0200

[[opsi-403-releasenotes-misc-changelogs-opsi-winst-test]]
==== Changelog de opsi-winst-test

opsi-winst-test (4.11.3.5-1) stable; urgency=low

	* Test of Linkfolder in login.opsiscript
	* Test of use of temporary loop constant in subsub call
	* Test of calculate
	* Test of 'no update script if setup is failed': new property: setfailed
	* Test of SetConfidential
	* Test of SetSkinDirectory
	* Test of LDAPSearch (username/password)
	* Test of execwith: winst (/32bit|/64bit|/sysnative)
	* Test of winbatch: /32bit|/64bit|/sysnative
	* Test of PatchTextFile /AllNTuserProfiles
	
-- detlef oertel <d.oertel@uib.de>  Wed,  16 Jan 2013 17:00:13 +0200

opsi-winst-test (4.11.3.4-1) stable; urgency=low

	* Test of Winbatch /RunAsLoggeedOnUser in login.ins
	
-- detlef oertel <d.oertel@uib.de>  Thu,  26 Oct 2012 17:00:13 +0200

[[opsi-403-releasenotes-misc-changelogs-jedit]]
==== Changelog de jedit

jedit_5.0.0-3 stable; urgency=low

   * opsi-winst.xml for version 4.11.3.5
   * code cleanup

-- detlef oertel <d.oertel@uib.de>  Fri, 15 Feb 2013 16:01:53 +0200

jedit_5.0.0-2 stable; urgency=low

   * jedit version with localization support

-- rupert röder <r.roeder@uib.de>  Tue, 27 Nov 2012 16:01:53 +0200

[[opsi-403-releasenotes-misc-changelogs-opsi-adminutils]]
==== Changelog de opsi-adminutils

opsi-adminutils (4.0.3.-1) stable; urgency=low

  * change to 4.0.3

-- detlef oertel <d.oertel@uib.de>  15 Feb 2013


opsi-adminutils (4.0.2.1-5) stable; urgency=low

  * correct parameters for configed.jnlp URL

-- rupert roeder <r.roeder@uib.de>  10 Jan 2013

opsi-adminutils (4.0.2.1-4) stable; urgency=low

  * removed parameter from configed.jnlp URL
  * removed opsi-configed version from control file

-- detlef oertel <d.oertel@uib.de>  04 Jan 2013


opsi-adminutils (4.0.2.1-3) stable; urgency=low

  * regshot 1.8.3 (include 64-bit)
  * added kitty

-- detlef oertel <d.oertel@uib.de>  11 Oct 2012


opsi-adminutils (4.0.2.1-2) stable; urgency=low
  * swingx.jar
  * configed.jar 4.0.2.5.4
-- bardo wolf <b.wolf@uib.de>  04 Sep 2012


opsi-adminutils (4.0.2.1-1) stable; urgency=low

[[opsi-403-releasenotes-misc-changelogs-opsi-template]]
==== Changelog de opsi-template

opsi-template (4.0.3-1) stable; urgency=low

	* default is now without property and 32 Bit

-- detlef oertel <d.oertel@uib.de>  Thu, 27 Sep 2012 16:01:53 +0200

[[opsi-403-releasenotes-misc-changelogs-windows-netboot]]
==== Changelog des produits netboot windows

windows (4.0.3-2) stable; urgency=low

  * fix in logging in real uefi mode
  
-- uib GmbH <info@uib.de>  Thu, 11 Mar 2013 15:19:15 +0000

windows (4.0.3-1) stable; urgency=low

  * do not copy winpe uefi boot files if not in uefi mode
  * code cleanup
  * new property winpe_partition_size
  * showdrivers.py:
      - Option -V for version output added.
      - byAudit: Translating model and vendor from hwinvent: characters <>?":|\/* will be translated to _

-- uib GmbH <info@uib.de>  Thu, 14 Feb 2013 15:19:15 +0000

windows (4.0.2-2) experimental; urgency=low

  * new property data_partition_create
  * detect if we are on uefi
  * if we are on uefi use gpt partitions
  * win8 (NT 6.2) support
  * new property use_raid1

-- uib GmbH <info@uib.de>  Mon, 27 Aug 2012 15:19:15 +0000


[[opsi-403-releasenotes-misc-changelogs-opsi-client-agent]]
==== Changelog de opsi-client-agent

opsi-client-agent (4.0.2.3-1) testing; urgency=low

  * opsiclientd.conf:
    - added new silent_install event
    - added new time event for silent_install
  * fix search algorithm for finding usersessions
  * fixed setting userrights for local opsi-winst
  * added new service-method for cleaning cache (WAN-Support)

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Wed, 14 Nov 2012 09:00:00 +0100

opsi-client-agent (4.0.2.3-2) testing; urgency=low

  * opsiclientd.conf:
    - [event_on_shutdown{installation_pending}]active=False
  * opsiclientd:
    - v4.0.1.75
    - new state installation_pending for future use (event_on_shutdown)
  * new product property: on_shutdown_active (true/false)
  * new updatescript, which installs shutdown files if on_shutdown_active=true

 -- Miriam Michaelis <m.michaelis@uib.de>  Wed, 05 Dec 2012 13:00:00 +0100

opsi-client-agent (4.0.2.3-1) testing; urgency=low

  * opsiclientd:
    - fix for user_cancelable = 0
    - fix for getSessioninformation
    - updated sessionhelper in utilities
    - added /usercontext parameter for user-login events. This option gives now opsi-winst the username.
    - fix for User-Login-Events on Windows 8: Do not fire event, if the Window Management Service is logged on.
  * new custom directory
    - is saved in preinst and restored in postinst
    - cfg/config.ini values will be overwritten by values from custom/config.ini (execption: pckey , bootmode) fixes #333
    - it is a good idea to delete all not used key from a custom/config.ini
    - files at the depot in custom\winstskin\*.* will be copied to custom\winstskin\ at the client and will be used by opsi-winst since version
    - files at the depot  in custom\notifier\*.* will be overwrite the files at the clients notifier directory
    - a existing file at the depot: custom\opsiclientd.conf will overwrite the opsiconfd.conf files at the clients opsiclientd directory, which comes from the 'dist' directory

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Wed, 14 Nov 2012 09:00:00 +0100

[[opsi-403-releasenotes-misc-changelogs-python-opsi]]
==== Changelog de python-opsi

python-opsi (4.0.3.1-1) testing; urgency=low

  * dhcp-backend: ddns-rev-domainname added to list where the values are written in double quotas
  * System: opsi-setup --init-current-config gives an warning instead of error, when vendor not found for network device
  * Posix:
    - saveImage returns the result from partclone if run was successfull.
    - readPartitionTable: Try to find out the right filesystem with blkid tool.
    - createPartition: allows linux as filesystem-type and produces partition with id 83
  * WindowsDriver: byAudit: Translating model and vendor from hwinvent: characters <>?":|\/* will be translated to _
  * python-opsi locale: danish added
  * compareVersion: fixed handling with versions from custom packages.
  * global.conf: fixed hostname entries
  * fixed resource directory listing for custom packages /repository
  * fix for ubuntu 12.10

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Tue, 05 Feb 2013 17:40:23 +0100

python-opsi (4.0.2.6-1) testing; urgency=low

  * Posix: getBlockDeviceControllerInfo():
    - if no devices attached on a AHCI-Controller (maybe a lshw or a kernel bug)
      try to find AHCI-Controller, if found try return the first found AHCI Controller
      for textmode-driverintegration (only for nt5)
  * Posix: modifications for newer ms-sys version
  * rpm-spec-file: noreplace option for dispatch.conf.default in files-section

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Mon, 07 Nov 2012 17:34:13 +0100

python-opsi (4.0.2.5-1) testing; urgency=low

  * fix in hwinvent procedure, don't crash if lshw don't work properly
  * fix for resizeNTFSPartition if blockAlignmnet is used (ntfs-restore-image)

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Fri, 02 Nov 2012 15:00:34 +0200

[[opsi-403-releasenotes-misc-changelogs-opsipxeconfd]]
==== Changelog de opsipxeconfd

opsipxeconfd (4.0.3.1-1) stable; urgency=low

  * featurepack-release 4.0.3
  * this version is stable, because no changes were made, only version modified for new featurepack-release

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Thu, 14 Feb 2013 17:57:02 +0100

[[opsi-403-releasenotes-misc-changelogs-opsiconfd]]
==== Changelog de opsiconfd

opsiconfd (4.0.3.1-1) testing; urgency=low

  * ressource: webstart jnlp build fixed for arguments.
  * added monitoring debug switch in opsiconfd.conf
  * fixed init-Script for using global.conf

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Tue, 05 Jan 2013 13:15:56 +0100

[[opsi-403-releasenotes-misc-changelogs-opsi-utils]]
==== Changelog de opsi-utils

opsi-utils (4.0.3.1-1) testing; urgency=low

  * opsi-product-updater: Added Blank line between header and message-body to fix empty body mails on exchange environment.
  * opsi-product-updater: fix for handling with custom products.
  * opsi-admin: added new HostControlSafeBackend in BackendManager initialization.

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Tue, 12 Feb 2013 12:42:44 +0200

[[opsi-403-releasenotes-misc-changelogs-opsi-linux-bootimage]]
==== Changelog de opsi-linux-bootimage

opsi-linux-bootimage (20130207-1) testing; urgency=low

  * added bc

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Fri, 01 Feb 2013 12:34:59 +0100

opsi-linux-bootimage (20130117-1) experimental; urgency=low

  * downgrade:
      ms-sys: 2.1.2
      kernel 3.6.11

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Wed, 17 Jan 2013 16:25:11 +0100

opsi-linux-bootimage (20130111-1) experimental; urgency=low

  * python-opsi 4.0.2.7-1
  * locale: danish and italian localisation added
  * kernel 3.7.1

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Fri, 11 Jan 2013 11:48:23 +0100

opsi-linux-bootimage (20121107-1) experimental; urgency=low

  * new ms-sys-version: 2.2.1

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Wed, 07 Nov 2012 17:51:31 +0100

opsi-linux-bootimage (20121105-1) experimental; urgency=low

  * python-opsi 4.0.2.6-1

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Mon, 05 Nov 2012 17:36:27 +0100

opsi-linux-bootimage (20121102-1) experimental; urgency=low

  * kernel 3.6.5
  * python-opsi 4.0.2.5-1

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Fri, 02 Nov 2012 15:11:43 +0100
 
opsi-linux-bootimage (20121024-1) unstable; urgency=low

  * kernel 3.6.3
  * python-opsi 4.0.2.5-1
  * added packages: cloop, cloop-utils, dmraid, rsync, partclone-utils, nbd-client, genisoimage

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Wed, 24 Oct 2012 12:57:00 +0200

opsi-linux-bootimage (20121011-1) experimental; urgency=low

  * kernel 3.6.1
  * python-opsi 4.0.2.4-1
  * Missing firmware from Broadcom-Chipsets added

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Thu, 11 Oct 2012 00:45:26 +0200

[[opsi-403-releasenotes-misc-changelogs-opsi-depotserver]]
==== Changelog de opsi-depotserver

opsi-depotserver (4.0.3.1-1) testing; urgency=low

  * opsi-setup: added renew-opsiconfd-cert task
  * opsi-setup: added special files in set rights to add execute bit for these files in depot

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Mon, 28 Jan 2013 17:34:42 +0100

[[opsi-403-releasenotes-misc-changelogs-opsi4ucs]]
==== Changelog de opsi4ucs

opsi4ucs (4.0.3.1-1) testing; urgency=low

  * join script: execute /usr/lib/univention-pam/ldap-group-to-file.py to resync the groups  (for ucs 3.1 support)
  * opsi-setup: set executebit for special opsi files in depot

 -- Erol Ueluekmen <e.ueluekmen@uib.de>  Tue, 05 Feb 2013 11:07:47 +0100

 
[[opsi-403-releasenotes-opsi-configed]]
==== Changelog de opsi-configed

opsi-configed (4.0.3.1-1) testing; urgency=low

  * host config editing grouped by a tree
  * last change column for products now possible
  * the configed log files are now placed in the user home directory in a folder .configed
  * log panes now allow selection of displayed levels
  * log panes allow selection of event type if a log file has lines with event
  type specification
  * improved search handling in log panes
  * log panes, software and hardware audit panes can be copied into separated frames
  
 -- Rupert Roeder <r.roeder@uib.de>  Fri, 25 Jan 2013 12:00:00 +0200

 
  * search function for windows software panel
  * reset client selection when returning from server or depot editing
  * bugfix in mac address editing
  * configed checks if read only version is requested and, if wanted, produces it

 -- Rupert Roeder <r.roeder@uib.de>  Mon, 03 Dec 2012 12:00:00 +0200

 
opsi-configed (4.0.2.10-1) testing;  urgency=low

  * new logging format, included time check for service calls

 -- Rupert Roeder <r.roeder@uib.de>  Fri, 02 Nov 2012 12:00:00 +0200

 
 opsi-configed (4.0.2.8-1) testing;  urgency=low

  * check of transgression of activated client numbers
  * read only option 

 -- Rupert Roeder <r.roeder@uib.de>  Mon, 22 Oct 2012 12:00:00 +0200

opsi-configed (4.0.2.7-1) testing;  urgency=low

  * reopening a saved search

 -- Rupert Roeder <r.roeder@uib.de>  Mon, 15 Oct 2012 12:00:00 +0200

opsi-configed (4.0.2.7-1) testing;  urgency=low

  * more caching and less reloading actions

 -- Rupert Roeder <r.roeder@uib.de>  Mon, 15 Oct 2012 12:00:00 +0200
 

