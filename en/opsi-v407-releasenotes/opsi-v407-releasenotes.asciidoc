////
; Copyright (c) uib gmbh (www.uib.de)
; This documentation is owned by uib
; and published under the german creative commons by-sa license
; see:
; http://creativecommons.org/licenses/by-sa/3.0/de/
; http://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; english:
; http://creativecommons.org/licenses/by-sa/3.0/
; http://creativecommons.org/licenses/by-sa/3.0/legalcode
;
; credits: http://www.opsi.org/credits/
////

////
;***************************************************************************
; Subversion:
; $Revision:  $ $Author: oertel $
; $Date: $
;***************************************************************************
////

:Author:    uib gmbh
:Email:     info@uib.de
:Revision:  4.0.7
:doctype:   book

// Include common opsi terms
include::../common/opsi_terms.asciidoc[]

[[opsi-407-releasenotes]]
= opsi Version 4.0.7 Release Notes

// Include common opsi copyright
include::../common/opsi_manual_copyright.asciidoc[]

[[opsi-407-releasenotes-supportmatrix]]
== opsi Support Matrix

This is an overview on which distributions and releases the opsi-server will run:

include::../common/opsi_manual_supportmatrix.asciidoc[]

If you are using an OS version which is not contained in the section above,
we recommend updating the OS before installing opsi v4.0.7.

[[opsi-407-releasenotes-overview]]
== Overview of the new features

The Highlights of this Release are:

* Ubuntu 16.04 (Xenial) support
* New opsi bootimage
* New opsi-linux netboot products and client-agent
* Product sorting while installation for (standard) algorithm 1 is fixed
* New opsi-client-agent

The opsi Service Release 4.0.7 comes with a whole bunch of new features and improvements.
Here is a summary:

* ######


* New opsi-bootimage
** Uses Ubuntu Xenial 16.04 as base
** Kernel 4.4.11


* opsi-configed:



* opsi-client-agent: +
** Neuer opsiclientd
** Neuer Client für den Kioskmode
** Upgrade de SSL libraries zu 1.0.2h

* opsi-winst / opsi-script (4.11.6.1)
** Many new functions
** Upgrade of the SSL libraries to 1.0.2h
** See special chapter: <<opsi-407-releasenotes-opsi-script>>


* python-opsi:

** Many improvements, new features and bugfixes. +
See special chapter: <<opsi-407-releasenotes-python-opsi>>


* opsi-clonezilla:
** new version
** runcommand 'ocs-live' is working again
** UEFI Support

* opsi-linux-support:
** New opsi-linux-client-agent (with 15 free starts)
** debian8 product that may use a local http repository
** ubunt16-04 product that may use a local http repository
** Posibillity to provide local http repositories for Linux OS installations 
** Produkt l-opsi-server für die automatisierte Installation von opsi-server Paketen auf einer Linux Maschine (z.B. zur Erstellung eines neuen Depotservers)





////
For details please refer to the opsi-v405-releasenotes manual and the revised opsi manuals.
////

[[opsi-407-releasenotes-packages]]
== list of packages

.server packages:
* opsi-depotserver
* opsi-linux-support
* opsi-utils
* opsiconfd
* python-opsi
* opsi-linux-bootimage
* opsi-configed

.opsi packages (localboot):
* opsi-client-agent
* opsi-configed
* config-win10

.opsi packages (netboot):
* win* 
* opsi-clonezilla

.opsi packaages (opsi-linux):
* centos70_
* redhat70_
* debian7-
* debian8-
* Ubuntu14-04
* Ubuntu16-04
* opensuse13-2
* sles12

With opsi 4.0.7 you can install debain8 and Ubuntu16-04 from a local apache repository. The opsi-linux-support package provides the apache2 system package
and also creates the neccessarry folders. You then have to fill these with our provided debian8 and ubuntu16-04 repository available at our download server.

.opsi packages(opsi-local-image):
* opsi-local-image-win* 
* opsi-local-image-capture
* opsi-local-image-capture-prepare


[[opsi-407-releasenotes-missing]]
== What is still missing (and under progress)

* opsi-client-agent: +
To execute opsi-winst scripts as the current user during logon 'User Profile Management'.

* opsi-linux-client-agent: +
** A real opsiclientd service for the following distributions: +
RedHat 7 +
CentOS 7 


* opsi-linux 4.0.7 netboot products: uefi support



[[opsi-407-releasenotes-knownbugs]]
== Known Bugs / Known Problems

.KNOWN BUGS:

* ######

.KNOWN PROBLEMS:

* ######

[[opsi-407-releasenotes-eol]]
== Discontinuation

[[opsi-407-releasenotes-eol_server]]
=== Discontinuation: Distributions for opsi-server

This chapter lists distributions that for several reasons are not supported by opsi anymore.

* ######

See also the support matrix: <<opsi-407-releasenotes-supportmatrix>>.

[[opsi-407-releasenotes-eol_winclient]]
=== Discontinuation clients: Windows versions

With opsi v4.0.7 the netboot packages for

* ######

are not maintained anymore. +
Also in the near future the Update Abos will not support these Windows versions anymore. +
Please contact us in case of any questions or concerns.

See also the chapter: <<opsi-407-releasenotes-netboot-windows>>.

[[opsi-407-releasenotes-eol_linclient]]
=== Discontinuation clients: Linux versions

With opsi v4.0.7 the netboot packages for

* ######

will not be maintained anymore. Please contact us in case of any questions or concerns.


[[opsi-407-releasenotes-installation]]
== Installation notes

For safety reasons we recommend creating a backup of your backends with +
{opsi-backup} before updating:
[source,prompt]
----
opsi-backup create
----

The products contained in this release depend on each other in many cases. +
Do not try to install just parts of this update.

We recommend to first update the server and then the opsi products.


To make sure that permissions are applied correctly +
we recommend to run ``opsi-setup --set-rights`` after the installation. +
Please be aware that the execution of latter can last for many minutes.


[[opsi-407-releasenotes-installation-opsipackages]]
=== Notes for updating opsi-packets

////
Bitte nachstehenden Block bei release nicht löschen sondern auskommentieren
////


For installing the testing server packets the opsi repository has to be changed from `opsi40` to `opsi40-testing`.

In case of Ubuntu 14.04: +
`deb http://download.opensuse.org/repositories/home:/uibmz:/opsi:/opsi40/xUbuntu_14.04 ./` +
replace with: +
`deb http://download.opensuse.org/repositories/home:/uibmz:/opsi:/opsi40-testing/xUbuntu_14.04 ./`

Then the packages can be updated. +


For example Ubuntu / Debian:
[source,prompt]
----
aptitude update
aptitude full-upgrade
----
For installing the opsi products: +

For installing the testing opsi products you should add to the file: +
`/etc/opsi/opsi-product-updater.conf` +
the following section

[source,prompt]
----
[repository_opsi_406_testing]
baseUrl = http://download.uib.de
dirs = opsi4.0/testing/opsi-v406/products/localboot, opsi4.0/testing/opsi-v406/products/netboot
active = true
username =
password =
autoInstall = false
autoUpdate = true
autoSetup = false
onlyDownload = false
----

You may append the `dirs` line by:

* `, opsi4.0/testing/opsi-v406/opsi-linux`

* `, opsi4.0/testing/opsi-v406/opsi-local-image`


Set in the section `[repository_uib]` the following line:
[source,prompt]
----
active = false
----
Then execute the opsi-product-updater.


To install all packets:
[source,prompt]
----
opsi-product-updater -i -vv
----

To install updates only:
[source,prompt]
----
opsi-product-updater -vv
----

////
Bitte vorstehenden Block bei release nicht löschen sondern auskommentieren
////

////
The installation does not require any special action. It is performed within the normal updates of your server and opsi products.

First update the server according to the update command of your Linux distribution. +

We recommend to set in `/etc/opsi/opsi-product-updater.conf`
in the section `[repository_uib]` the following to get all products even if they start with win* :
[source,prompt]
----
excludes =
----

If you need the opsi-linux products you should append the `dirs` entry: +

[source,prompt]
----
dirs = opsi4.0/products/localboot, opsi4.0/products/netboot
----
by the path `opsi4.0/products/opsi-linux`

If you need the opsi-local-image products you should append the `dirs` entry
by the path `opsi4.0/products/opsi-local-image`

Then execute the opsi-product-updater.

[source,prompt]
----
opsi-product-updater -i -vv
----

To install updates only:
[source,prompt]
----
opsi-product-updater -vv
----

In case of a multi depot installation first upgrade the config-server before upgrading the depots.


If you want to use product-ids with a length of more than 32 characters and are using the MySQL-backend please update the table definition on your configserver with the following command:

[source,prompt]
----
opsi-setup --update-mysql
----
////

[[opsi-407-releasenotes-clientagent]]
== New opsi-client-agent

* New opsiclientd
* New Agent for kiosk mode (software on demand)

image::opsi-client-kiosk.png["{opsi-kiosk-client}: opsi-kiosk-client", width=400]


[[opsi-407-releasenotes-linux]]
== Linuxsupport

############
////
include::../common/opsi_manual_linux.asciidoc[]
////

[[opsi-407-releasenotes-opsi-script]]
== opsi-script / opsi-winst 4.11.6

* Security Upgrade to Windows SSL libraries 1.0.2h (libeay32.dll, ssleay32.dll) +

* New manuals:

** opsi-winst-refrence-card with topic related function listing (by topic)

* New stringlist functions:

`setStringInListAtIndex(`<newstring>,<list>,<indexstr>`) : stringlist`   //since 4.11.6 [W/L]


* New: Functinons for handling JSON strings and stringlists

[[opsi-winst-rc-json]]
=== opsiservicecall and json Related functions [W/L]

`jsonIsValid(`<jsonstr>`) : boolean`  //since 4.11.6: [W/L]

`jsonIsArray(`<jsonstr>`) : boolean`  //since 4.11.6: [W/L]

`jsonIsObject(`<jsonstr>`) : boolean`  //since 4.11.6: [W/L]

`jsonAsObjectHasKey(`<jsonstr>,<keystr>`) : boolean`  //since 4.11.6: [W/L]

`jsonAsArrayCountElements(`<jsonstr>`) : intstr`  //since 4.11.6: [W/L]

`jsonAsObjectCountElements(`<jsonstr>`) : intstr`  //since 4.11.6: [W/L]

`jsonAsArrayGetElementByIndex(`<jsonstr>, <indexstr>`) : jsonstring`  //since 4.11.6: [W/L]

`jsonAsObjectGetValueByKey(`<jsonstr>, <keystr>`) : valuestring`  //since 4.11.6: [W/L]

`jsonAsObjectSetValueByKey(`<jsonstr>, <keystr>,<valuestring>`) : jsonstring`  //since 4.11.6: [W/L]

`jsonAsObjectSetStringtypeValueByKey(`<jsonstr>, <keystr>,<valuestring>`) : jsonstring`  //since 4.11.6: [W/L]

`jsonAsArrayPutObjectByIndex(`<jsonstr>, <indexstr>, <objectstr>`) : jsonstring`  //since 4.11.6: [W/L]

`jsonAsArrayToStringList(`<jsonstr>`) : stringlist`  //since 4.11.6: [W/L]

`jsonStringListToJsonArray(`<strlist>`) : jsonstr`  //since 4.11.6: [W/L]

`jsonAsObjectGetKeyList(`<jsonstr>`) : stringlist`  //since 4.11.6: [W/L]

[[opsi-winst-rc-process]]
=== Process and Script Related functions [W/L]

`waitForPackageLock(`<seconds timeout string>,<bool should we kill>`) : bool` //since 4.11.6.1 [L] +
Returns `true` if the Linux package system is not locked by an other process. If it is locked, it waits <seconds timeout string> to get the lock. If the timeout is reached and <bool should we kill> is `true` than the locking process is killed but using this feature ist *not recommended*.

* `processIsRunning(`<process name>`) : boolean`  //since 4.11.6.1 [W/L] +
Returns `true` if <process name> is found in the process list

* `shellCall (`<command string>`) : stringlist (output)` //since 4.11.4.2 [W/L] +
Executing <command string> with the standard shell (cmd.exe / bash)
[source,winst]
----
set $list$= shellCall('net start')
----
Is a shortcut for this expression:
[source,winst]
----
set $list$ = getOutStreamFromSection ('DosInAnIcon_netstart winst /sysnative')

[DosInAnIcon_netstart]
net start
----

* `shellCall (`<command string>`) : noresult` //since 4.11.6.1 [W/L] +
[source,winst]
----
shellCall('net start')
----
Is a shortcut for this expression:
[source,winst]
----
DosInAnIcon_netstart winst /sysnative

[DosInAnIcon_netstart]
net start
----


* `shellCall (`<command string>`) : string (exitcode)` //since 4.11.6.1 [W/L] +
[source,winst]
----
set $exitcode$ = shellCall('net start')
----
Is a shortcut for this expression:
[source,winst]
----
DosInAnIcon_netstart winst /sysnative
set $exitcode$ = getLastExitcode

[DosInAnIcon_netstart]
net start
----

* `startProcess(`<string>`) : string (exitcode)` //since 4.11.6.1 [W/L] +
Starts the command binary <string> as process and returns te exitcode +
[source,winst]
----
set $exitcode$ = startProcess('setup.exe /S')
----
Is a shortcut for this expression:
[source,winst]
----
Winbatch_setup
set $exitcode$ = getLastExitcode

[Winbatch_setup]
setup.exe /S
----
In fact it is internal a winbatch call, so all the `winbatch` modifiers are also allowed for `startProcess`

* `/LetThemGo` +
This is the contrary to `/WaitOnClose`. It is used if '{opsi-winst}/opsi-script' shall proceed while the started processes run in their own threads.

* `/TimeOutSeconds` <seconds> +
A timeout setting. After waiting <seconds>, '{opsi-winst}/opsi-script' will end the process. +
Since version 4.11.3, /TimeOutSeconds may be used without a waiting condition (e.g. `/WaitForProcessEnding`) but not in combination with `/WaitSeconds`. +
Since version 4.11.4.6 the time progress from start until timeout is displayed by the progressbar. +

* `/WaitSeconds` [number of seconds] +
If a call includes the parameter /WaitSeconds [number of seconds], then '{opsi-winst}/opsi-script' is waiting for [number of seconds] before proceeding. In the default configuration, we also wait for any programs that are currently running to finish. If we combine the parameter /WaitSeconds with the option `/LetThemGo`, then '{opsi-winst}/opsi-script' continues processing after the waiting time is finished.
 
* `/WaitForProcessEnding` <program name> +
Waits for the process called <program name> to end. +
Should be combined with `/TimeOutSeconds`.

*  `/32Bit` //since 4.11.3.5  [W] +
This is the default. The paths within the section are assumed to be 32 bit pathes. +
Example: `c:\windows\system32\regedit.exe` calls (even when running on a 64 bit system) the 32 bit 'regedit.exe'.

*  `/64Bit` //since 4.11.3.5  [W] +
The paths within the section are assumed to be 64 bit paths. +
Example: `c:\windows\system32\regedit.exe` executes (running on a 64 bit system) the 64 bit 'regedit.exe'.

*  `/SysNative` //since 4.11.3.5  [W] +
The paths within the section are assigned according to the OS architecture interpretiert. +
Example: `c:\windows\system32\regedit.exe` running on a 64bit system calls the 64 bit 'regedit.exe' and running on a 32 bit system the 32 bit 'regedit.exe'.




[[opsi-winst-rc-cryptfunc]]
=== Crypt / Hash related functions [W/L]

`encryptStringBlow(`<keystring>,<datastring>`) : string` [W/L]

`decryptStringBlow(`<keystring>,<datastring>`) : string` [W/L]

`md5sumFromFile(`<path to file>`) : string` [W/L]

[[opsi-winst-rc-timefunc]]
=== time / date related functions

`timeStampAsFloatStr : string` (Floating Number - format: 'days.decimal days') //since 4.11.6 [W/L]

[[opsi-winst-rc-misc]]
=== Misc news

* `getMSVersionMap` +
Has now a new key entry: `ReleaseID` which gives you the sub release of 'Windows 10' like e.g. '1511'.
The Value comes from the Registry: "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" "ReleaseID"

* `getLinuxVersionMap` +
Has now a new key entry: `SubRelease` which gives you the sub release (patchlevel) of 'SLES 11' like e.g. '4'.

* `ShellBatch /showoutput` +
Shows the output of the called command in a seperate window. +
Now also available at Linux. +
Now moves the main Window to top/right and the ouptup window to left/down.

* `strLoadTextfile`  and `strLoadTextFileWithEncoding` +
Reads the firs line of the given file. Now without newline chars.

* repaired product ordering for `product_sort_algorithm 1` 


[[opsi-407-releasenotes-python-opsi]]
== python-opsi 4.0.7.

###################

[[opsi-407-releasenotes-netboot-windows]]
== opsi Support Matrix Windows Clients

Im folgenden finden Sie eine Übersicht auf welchen Windows Plattformen opsi
als Client läuft.

include::../common/opsi_manual_supportmatrix-winclient.asciidoc[]




[[opsi-407-releasenotes-misc]]
== Sonstiges

[[opsi-407-releasenotes-misc-changelogs]]
=== Changelogs:


[[opsi-407-releasenotes-misc-changelogs-opsi-configed]]
==== Changelog opsi-configed

#############

[[opsi-407-releasenotes-misc-changelogs-opsi-client-agent]]
==== Changelog opsi-client-agent

###############

[[opsi-407-releasenotes-misc-changelogs-config-win10]]
###############

[[opsi-407-releasenotes-misc-changelogs-opsi-script]]
==== Changelog opsi-script / opsi-winst
###############


[[opsi-407-releasenotes-misc-changelogs-windows-netboot]]
==== Changelog windows netboot products
###############

[[opsi-407-releasenotes-misc-changelogs-linux-netboot]]
==== Changelog linux netboot products

###############

.centos70

###############


.debian7

###############


.debian8

###############


.opensuse13-2
###############

.sles12
###############

.redhat70
###############

.Ubuntu14-04
###############


[[opsi-407-releasenotes-misc-changelogs-opsi-local-image]]
==== Changelog opsi-local-image

###############


[[opsi-407-releasenotes-misc-changelogs-misc-netboot]]
==== Changelog misc netboot products

###############

[[opsi-407-releasenotes-misc-changelogs-python-opsi]]
==== Changelog python-opsi

###############

[[opsi-407-releasenotes-misc-changelogs-opsiconfd]]
==== Changelog opsiconfd

###############
####################

[[opsi-407-releasenotes-misc-changelogs-opsi-utils]]
==== Changelog opsi-utils

###############

####################

[[opsi-407-releasenotes-misc-changelogs-opsi-linux-bootimage]]
==== Changelog opsi-linux-bootimage

###############

[[opsi-407-releasenotes-misc-changelogs-opsi-depotserver]]
==== Changelog opsi-depotserver

###############

####################

[[opsi-407-releasenotes-misc-changelogs-opsi-atftp]]
==== Changelog opsi-atftp


####################

[[opsi-407-releasenotes-misc-changelogs-opsipxeconfd]]
==== Changelog opsi-atftp


####################

[[opsi-407-releasenotes-misc-changelogs-opsi4ucs]]
==== Changelog opsi4ucs


####################

[[opsi-407-releasenotes-misc-changelogs-opsi-swaudit]]
==== Changelog opsi-swaudit
####################

 [[opsi-407-releasenotes-misc-changelogs-opsi-template]]
==== Changelog opsi-template
####################

